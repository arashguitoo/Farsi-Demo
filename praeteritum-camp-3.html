<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>√úbungscamp Pr√§teritum - Persisch</title>
    <script data-goatcounter="https://aguitoo.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            padding: 10px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* Navigation */
        .nav-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .nav-btn {
            background: #e94560;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .nav-btn:hover {
            background: #ff6b6b;
            transform: scale(1.05);
        }
        
        .nav-btn.home {
            background: #4ecdc4;
        }
        
        .nav-btn.restart {
            background: #ffa502;
        }
        
        /* Screens */
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block;
        }
        
        /* Home Screen */
        .home-screen h1 {
            text-align: center;
            font-size: 1.8em;
            margin-bottom: 10px;
            color: #4ecdc4;
        }
        
        .home-screen .subtitle {
            text-align: center;
            margin-bottom: 30px;
            opacity: 0.8;
        }
        
        .exercise-card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .exercise-card:hover {
            background: rgba(255,255,255,0.2);
            border-color: #4ecdc4;
            transform: translateX(5px);
        }
        
        .exercise-card h3 {
            color: #4ecdc4;
            margin-bottom: 8px;
        }
        
        .exercise-card p {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        /* Instructions */
        .instructions-box {
            background: rgba(78, 205, 196, 0.2);
            border: 1px solid #4ecdc4;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-size: 0.9em;
        }
        
        .instructions-box h4 {
            color: #4ecdc4;
            margin-bottom: 10px;
        }
        
        /* Persian Text */
        .persian {
            font-family: 'Vazirmatn', 'Tahoma', sans-serif;
            direction: rtl;
            font-size: 1.3em;
        }
        
        .umschrift {
            color: #ffa502;
            font-style: italic;
        }
        
        /* √úbung 1: Matching */
        .matching-container {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin: 20px 0;
        }
        
        .matching-column {
            flex: 1;
        }
        
        .matching-column h4 {
            text-align: center;
            margin-bottom: 10px;
            color: #4ecdc4;
        }
        
        .match-item {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            border: 2px solid transparent;
            font-size: 1.05em;
        }
        
        .match-item.persian {
            font-size: 1.15em;
        }
        
        .match-item:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .match-item.selected {
            border-color: #4ecdc4;
            background: rgba(78, 205, 196, 0.3);
        }
        
        .match-item.correct {
            border-color: #2ecc71;
            background: rgba(46, 204, 113, 0.3);
        }
        
        .match-item.wrong {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.3);
            animation: shake 0.5s;
        }
        
        .match-item.matched {
            opacity: 0.5;
            pointer-events: none;
            border-color: #2ecc71;
            background: rgba(46, 204, 113, 0.2);
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* √úbung 2: Multiple Choice */
        .question-box {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .question-text {
            font-size: 1.2em;
            margin-bottom: 15px;
        }
        
        .options-container {
            display: grid;
            gap: 10px;
        }
        
        .option-btn {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s;
        }
        
        .option-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: #4ecdc4;
        }
        
        .option-btn.correct {
            background: rgba(46, 204, 113, 0.5);
            border-color: #2ecc71;
        }
        
        .option-btn.wrong {
            background: rgba(231, 76, 60, 0.5);
            border-color: #e74c3c;
        }
        
        /* Word Bank */
        .word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin: 15px 0;
        }
        
        .word-chip {
            background: rgba(255,255,255,0.15);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .word-chip:hover {
            background: rgba(255,255,255,0.25);
        }
        
        .word-chip.selected {
            background: rgba(78, 205, 196, 0.4);
            border-color: #4ecdc4;
        }
        
        .word-chip.used {
            opacity: 0.4;
            pointer-events: none;
        }
        
        .answer-area {
            background: rgba(0,0,0,0.3);
            min-height: 50px;
            border-radius: 10px;
            padding: 10px;
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
            direction: rtl;
        }
        
        .answer-chip {
            background: #4ecdc4;
            color: #1a1a2e;
            padding: 8px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* √úbung 3: Input */
        .sentence-card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .sentence-german {
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        
        .sentence-hint {
            color: #ffa502;
            font-size: 0.9em;
            margin-bottom: 15px;
        }
        
        .input-area {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .persian-input {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(0,0,0,0.3);
            color: white;
            font-size: 1.2em;
            direction: rtl;
            font-family: 'Vazirmatn', 'Tahoma', sans-serif;
        }
        
        .persian-input:focus {
            outline: none;
            border-color: #4ecdc4;
        }
        
        .check-btn {
            background: #4ecdc4;
            color: #1a1a2e;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .check-btn:hover {
            background: #45b7aa;
        }
        
        .feedback {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .feedback.correct {
            background: rgba(46, 204, 113, 0.3);
            border: 1px solid #2ecc71;
        }
        
        .feedback.wrong {
            background: rgba(231, 76, 60, 0.3);
            border: 1px solid #e74c3c;
        }
        
        /* Progress Bar */
        .progress-container {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            height: 20px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4, #44a08d);
            border-radius: 10px;
            transition: width 0.5s;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 5px;
            font-size: 0.9em;
        }
        
        /* Certificate */
        .certificate-screen {
            text-align: center;
        }
        
        .certificate-canvas {
            max-width: 100%;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .download-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            margin: 10px;
            transition: all 0.3s;
        }
        
        .download-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.5);
        }
        
        /* Tooltip for new words */
        .tooltip-word {
            position: relative;
            color: #ffa502;
            cursor: help;
            border-bottom: 1px dashed #ffa502;
        }
        
        .tooltip-word:hover::after {
            content: attr(data-meaning);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            white-space: nowrap;
            font-size: 0.8em;
            z-index: 100;
        }
        
        /* Stats */
        .stats-box {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        
        .stat-item h4 {
            color: #4ecdc4;
            font-size: 1.5em;
        }
        
        .stat-item p {
            font-size: 0.8em;
            opacity: 0.7;
        }
        
        /* Responsive */
        @media (max-width: 400px) {
            .matching-container {
                flex-direction: column;
            }
            
            .nav-btn {
                padding: 8px 12px;
                font-size: 12px;
            }
        }
        
        /* Loading animation */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 50px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255,255,255,0.1);
            border-top-color: #4ecdc4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Success animation */
        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .celebrate {
            animation: celebrate 0.5s ease-in-out;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Navigation Bar -->
        <div class="nav-bar">
            <button class="nav-btn home" onclick="goHome()">üè† Home</button>
            <span id="current-exercise">√úbungscamp Pr√§teritum</span>
            <button class="nav-btn restart" onclick="restartExercise()">üîÑ Neu</button>
        </div>

        <!-- HOME SCREEN -->
        <div id="home-screen" class="screen active">
            <div class="home-screen">
                <h1>üáÆüá∑ √úbungscamp Pr√§teritum</h1>
                <p class="subtitle">Persisch lernen - Stufe A1</p>
                
                <div class="instructions-box">
                    <h4>üìã Anweisungen</h4>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>Jede √úbung muss richtig gel√∂st werden</li>
                        <li>Falsche Antworten kommen zur√ºck in den Stapel</li>
                        <li>Am Ende jeder √úbung: Zertifikat herunterladen</li>
                        <li>üè† = Zur√ºck zur Startseite</li>
                        <li>üîÑ = √úbung neu starten</li>
                    </ul>
                    <p style="margin-top: 10px; padding: 8px; background: rgba(255,165,2,0.2); border-radius: 5px; border-left: 3px solid #ffa502;">
                        <strong>‚ö†Ô∏è Wichtig:</strong> Schreibe immer vollst√§ndige S√§tze mit Subjekt! Das Subjekt (ŸÖŸÜÿå ÿ™Ÿàÿå ÿßŸà...) darf nicht weggelassen werden.
                    </p>
                </div>
                
                <div class="exercise-card" onclick="startExercise(1)">
                    <h3>üìù √úbung 1: Vokabel-Matching</h3>
                    <p>Verbinde deutsche W√∂rter mit ihren persischen √úbersetzungen</p>
                </div>
                
                <div class="exercise-card" onclick="startExercise(2)">
                    <h3>üéØ √úbung 2: S√§tze verstehen</h3>
                    <p>Multiple Choice & Satzbildung mit Wortbank</p>
                </div>
                
                <div class="exercise-card" onclick="startExercise(3)">
                    <h3>üîÑ √úbung 3: Verb-Konjugation</h3>
                    <p>30 Multiple-Choice-Fragen zur Verbkonjugation</p>
                </div>
                
                <div class="exercise-card" onclick="startExercise(4)">
                    <h3>‚úçÔ∏è √úbung 4: Pr√§teritum schreiben</h3>
                    <p>30 S√§tze im Pr√§teritum selbst eingeben</p>
                </div>
                
                <!-- Trennlinie -->
                <div style="margin: 30px 0; border-top: 2px dashed rgba(255,255,255,0.3); position: relative;">
                    <span style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 0 15px; color: #ffa502; font-size: 0.9em;">Freies √úben</span>
                </div>
                
                <div class="exercise-card" onclick="startVocabTraining()" style="border-color: #ffa502; background: rgba(255,165,2,0.1);">
                    <h3 style="color: #ffa502;">üìö Vokabeltraining</h3>
                    <p>Alle Vokabeln als Endlos-Stapel zum √úben (ohne Zertifikat)</p>
                </div>
                
                <div class="exercise-card" onclick="startVerbTraining()" style="border-color: #ffa502; background: rgba(255,165,2,0.1);">
                    <h3 style="color: #ffa502;">üîÑ Verb-Konjugation Training</h3>
                    <p>Pronomen ‚Üî konjugierte Verben matchen (ŸÅÿßÿ±ÿ≥€å ‚Üî ŸÅÿßÿ±ÿ≥€å)</p>
                </div>
            </div>
        </div>

        <!-- √úBUNG 1: MATCHING -->
        <div id="exercise1-screen" class="screen">
            <h2 style="text-align: center; margin-bottom: 10px;">Vokabel-Matching</h2>
            <p style="text-align: center; opacity: 0.8; margin-bottom: 15px;">Tippe auf ein deutsches und dann ein persisches Wort</p>
            
            <div class="stats-box">
                <div class="stat-item">
                    <h4 id="e1-matched">0</h4>
                    <p>Richtig</p>
                </div>
                <div class="stat-item">
                    <h4 id="e1-round">1</h4>
                    <p>Runde</p>
                </div>
            </div>
            
            <div class="matching-container">
                <div class="matching-column">
                    <h4>Deutsch</h4>
                    <div id="german-words"></div>
                </div>
                <div class="matching-column">
                    <h4>ŸÅÿßÿ±ÿ≥€å</h4>
                    <div id="persian-words"></div>
                </div>
            </div>
            
            <button class="nav-btn" style="width: 100%; margin-top: 20px;" onclick="nextMatchingRound()" id="e1-next-btn" disabled>N√§chste Runde ‚Üí</button>
        </div>

        <!-- VOKABELTRAINING (ENDLOS) -->
        <div id="vocab-training-screen" class="screen">
            <h2 style="text-align: center; margin-bottom: 10px;">üìö Vokabeltraining</h2>
            <p style="text-align: center; opacity: 0.8; margin-bottom: 15px;">Alle Vokabeln - Endlos-Stapel</p>
            
            <div class="stats-box">
                <div class="stat-item">
                    <h4 id="vt-correct">0</h4>
                    <p>Richtig</p>
                </div>
                <div class="stat-item">
                    <h4 id="vt-total">0</h4>
                    <p>Gesamt</p>
                </div>
                <div class="stat-item">
                    <h4 id="vt-remaining">0</h4>
                    <p>√úbrig</p>
                </div>
            </div>
            
            <div class="matching-container">
                <div class="matching-column">
                    <h4>Deutsch</h4>
                    <div id="vt-german-words"></div>
                </div>
                <div class="matching-column">
                    <h4>ŸÅÿßÿ±ÿ≥€å</h4>
                    <div id="vt-persian-words"></div>
                </div>
            </div>
            
            <button class="nav-btn" style="width: 100%; margin-top: 20px;" onclick="nextVTRound()" id="vt-next-btn" disabled>N√§chste Runde ‚Üí</button>
        </div>

        <!-- VERB-KONJUGATION TRAINING (ENDLOS) -->
        <div id="verb-training-screen" class="screen">
            <h2 style="text-align: center; margin-bottom: 10px;">üîÑ Verb-Konjugation Training</h2>
            <p style="text-align: center; opacity: 0.8; margin-bottom: 5px;">Verbinde Pronomen mit der richtigen Verbform</p>
            <p id="verb-training-verb" style="text-align: center; color: #4ecdc4; font-size: 1.2em; margin-bottom: 15px;" class="persian"></p>
            
            <div class="stats-box">
                <div class="stat-item">
                    <h4 id="vbt-correct">0</h4>
                    <p>Richtig</p>
                </div>
                <div class="stat-item">
                    <h4 id="vbt-total">0</h4>
                    <p>Gesamt</p>
                </div>
                <div class="stat-item">
                    <h4 id="vbt-verb-count">0</h4>
                    <p>Verben</p>
                </div>
            </div>
            
            <div class="matching-container">
                <div class="matching-column">
                    <h4>ÿ∂ŸÖ€åÿ± (Pronomen)</h4>
                    <div id="vbt-pronouns"></div>
                </div>
                <div class="matching-column">
                    <h4>ŸÅÿπŸÑ (Verb)</h4>
                    <div id="vbt-verbs"></div>
                </div>
            </div>
            
            <button class="nav-btn" style="width: 100%; margin-top: 20px;" onclick="nextVerbTrainingRound()" id="vbt-next-btn" disabled>N√§chstes Verb ‚Üí</button>
        </div>

        <!-- √úBUNG 2: MULTIPLE CHOICE / WORD BANK -->
        <div id="exercise2-screen" class="screen">
            <h2 style="text-align: center; margin-bottom: 10px;">S√§tze verstehen</h2>
            
            <div class="progress-container">
                <div class="progress-bar" id="e2-progress" style="width: 0%"></div>
            </div>
            <p class="progress-text"><span id="e2-current">0</span> / <span id="e2-total">0</span> Aufgaben</p>
            
            <div id="e2-question-area"></div>
        </div>

        <!-- √úBUNG 3: VERB-KONJUGATION -->
        <div id="exercise3-screen" class="screen">
            <h2 style="text-align: center; margin-bottom: 10px;">Verb-Konjugation</h2>
            
            <div class="progress-container">
                <div class="progress-bar" id="e3-progress" style="width: 0%"></div>
            </div>
            <p class="progress-text"><span id="e3-current">0</span> / 30 Fragen</p>
            
            <div id="e3-question-area"></div>
        </div>

        <!-- √úBUNG 4: PR√ÑTERITUM EINGABE -->
        <div id="exercise4-screen" class="screen">
            <h2 style="text-align: center; margin-bottom: 10px;">Pr√§teritum schreiben</h2>
            
            <div class="progress-container">
                <div class="progress-bar" id="e4-progress" style="width: 0%"></div>
            </div>
            <p class="progress-text"><span id="e4-current">0</span> / 30 S√§tze</p>
            
            <div id="e4-sentence-area"></div>
        </div>

        <!-- CERTIFICATE SCREEN -->
        <div id="certificate-screen" class="screen">
            <div class="certificate-screen">
                <h2>üéâ Herzlichen Gl√ºckwunsch!</h2>
                <p style="margin: 10px 0;">Du hast die √úbung erfolgreich abgeschlossen!</p>
                
                <div id="name-input-area" style="margin: 20px 0;">
                    <label style="display: block; margin-bottom: 8px;">Dein Name f√ºr das Zertifikat:</label>
                    <input type="text" id="certificate-name" placeholder="Vorname Nachname" 
                           style="padding: 12px; border-radius: 8px; border: 2px solid #4ecdc4; background: rgba(0,0,0,0.3); color: white; font-size: 1.1em; width: 80%; max-width: 300px;">
                    <button class="nav-btn" style="margin-left: 10px; margin-top: 10px;" onclick="generateCertificateWithName()">Zertifikat erstellen</button>
                </div>
                
                <canvas id="certificate-canvas" class="certificate-canvas" width="600" height="400" style="display: none;"></canvas>
                
                <div id="download-area" style="display: none;">
                    <a id="download-link" class="download-btn" style="display: inline-block; text-decoration: none;">üì• Zertifikat herunterladen</a>
                </div>
                
                <button class="nav-btn home" style="margin-top: 20px;" onclick="goHome()">üè† Zur√ºck zur Startseite</button>
            </div>
        </div>
    </div>

    <script>
        // ===================== VOCABULARY DATA =====================
        const vocabulary = [
            // Familie
            { de: "die Familie", fa: "ÿÆÿßŸÜŸêŸàÿßÿØŸá", um: "·∏´ƒÅnevƒÅde" },
            { de: "der Vater", fa: "ŸæŸêÿØŸéÿ±", um: "pedar" },
            { de: "die Mutter", fa: "ŸÖÿßÿØŸéÿ±", um: "mƒÅdar" },
            { de: "die Eltern", fa: "ŸæÿØÿ± Ÿà ŸÖÿßÿØÿ±", um: "pedar-o mƒÅdar" },
            { de: "der Bruder", fa: "ÿ®ÿ±ÿßÿØŸéÿ±", um: "barƒÅdar" },
            { de: "die Schwester", fa: "ÿÆŸàÿßŸáŸéÿ±", um: "·∏´ƒÅhar" },
            { de: "der Sohn", fa: "ŸæŸêÿ≥Ÿéÿ±", um: "pesar" },
            { de: "die Tochter", fa: "ÿØŸèÿÆÿ™Ÿéÿ±", um: "do·∏´tar" },
            { de: "der Gro√üvater", fa: "ŸæÿØÿ±ÿ®Ÿèÿ≤Ÿèÿ±⁄Ø", um: "pedar-bozorg" },
            { de: "die Gro√ümutter", fa: "ŸÖÿßÿØÿ±ÿ®Ÿèÿ≤Ÿèÿ±⁄Ø", um: "mƒÅdar-bozorg" },
            { de: "das Kind", fa: "ÿ®⁄ÜŸá", um: "baƒçƒçe" },
            { de: "der Onkel", fa: "ÿπŸÖŸà / ÿØÿß€å€å", um: "am≈´ / dƒÅyƒ´" },
            { de: "die Tante", fa: "ÿπŸÖŸá / ÿÆÿßŸÑŸá", um: "amme / ·∏´ƒÅle" },
            { de: "der Mann", fa: "ŸÖŸéÿ±ÿØ", um: "mard" },
            { de: "die Frau", fa: "ÿ≤ŸéŸÜ", um: "zan" },
            // Possessivkonstruktionen
            { de: "mein Vater", fa: "ŸæÿØÿ± ŸÖŸÜ", um: "pedar-e man" },
            { de: "meine Mutter", fa: "ŸÖÿßÿØÿ± ŸÖŸÜ", um: "mƒÅdar-e man" },
            { de: "mein Bruder", fa: "ÿ®ÿ±ÿßÿØÿ± ŸÖŸÜ", um: "barƒÅdar-e man" },
            { de: "meine Schwester", fa: "ÿÆŸàÿßŸáÿ± ŸÖŸÜ", um: "·∏´ƒÅhar-e man" },
            { de: "dein Vater", fa: "ŸæÿØÿ± ÿ™Ÿà", um: "pedar-e to" },
            { de: "deine Mutter", fa: "ŸÖÿßÿØÿ± ÿ™Ÿà", um: "mƒÅdar-e to" },
            { de: "sein/ihr Vater", fa: "ŸæÿØÿ± ÿßŸà", um: "pedar-e u" },
            { de: "seine/ihre Mutter", fa: "ŸÖÿßÿØÿ± ÿßŸà", um: "mƒÅdar-e u" },
            { de: "unser Haus", fa: "ÿÆÿßŸÜŸá ŸÖÿß", um: "·∏´ƒÅne-ye mƒÅ" },
            { de: "mein Zuhause", fa: "ÿÆÿßŸÜŸá ŸÖŸÜ", um: "·∏´ƒÅne-ye man" },
            { de: "dein Zuhause", fa: "ÿÆÿßŸÜŸá ÿ™Ÿà", um: "·∏´ƒÅne-ye to" },
            { de: "unser Kind", fa: "ÿ®⁄ÜŸá ŸÖÿß", um: "baƒçƒçe-ye mƒÅ" },
            { de: "mein Kind", fa: "ÿ®⁄ÜŸá ŸÖŸÜ", um: "baƒçƒçe-ye man" },
            { de: "mein/e Freund/in", fa: "ÿØŸàÿ≥ÿ™ ŸÖŸÜ", um: "dust-e man" },
            { de: "dein/e Freund/in", fa: "ÿØŸàÿ≥ÿ™ ÿ™Ÿà", um: "dust-e to" },
            { de: "euer/eure Freund/in", fa: "ÿØŸàÿ≥ÿ™ ÿ¥ŸÖÿß", um: "dust-e ≈°omƒÅ" },
            { de: "mein/e Lehrer/in", fa: "ŸÖÿπŸÑŸÖ ŸÖŸÜ", um: "mo øallem-e man" },
            { de: "unsere Familie", fa: "ÿÆÿßŸÜŸàÿßÿØŸá ŸÖÿß", um: "·∏´ƒÅnevƒÅde-ye mƒÅ" },
            { de: "meine Familie", fa: "ÿÆÿßŸÜŸàÿßÿØŸá ŸÖŸÜ", um: "·∏´ƒÅnevƒÅde-ye man" },
            // Zahlen
            { de: "eins", fa: "€å⁄©", um: "yek" },
            { de: "zwei", fa: "ÿØŸà", um: "do" },
            { de: "drei", fa: "ÿ≥Ÿá", um: "se" },
            { de: "vier", fa: "⁄ÜŸéŸáÿßÿ±", um: "ƒçahƒÅr" },
            { de: "f√ºnf", fa: "ŸæŸéŸÜÿ¨", um: "panj" },
            { de: "sechs", fa: "ÿ¥ÿ¥", um: "≈°e≈°" },
            { de: "sieben", fa: "ŸáŸÅÿ™", um: "haft" },
            { de: "acht", fa: "Ÿáÿ¥ÿ™", um: "ha≈°t" },
            { de: "neun", fa: "ŸÜŸèŸá", um: "noh" },
            { de: "zehn", fa: "ÿØŸá", um: "dah" },
            // Zeit
            { de: "6 Uhr", fa: "ÿ≥ÿßÿπÿ™ ÿ¥ÿ¥", um: "sƒÅ øat-e ≈°e≈°" },
            { de: "7 Uhr", fa: "ÿ≥ÿßÿπÿ™ ŸáŸÅÿ™", um: "sƒÅ øat-e haft" },
            { de: "8 Uhr", fa: "ÿ≥ÿßÿπÿ™ Ÿáÿ¥ÿ™", um: "sƒÅ øat-e ha≈°t" },
            // Allgemein
            { de: "Hallo", fa: "ÿ≥ŸéŸÑÿßŸÖ", um: "salƒÅm" },
            { de: "der/die Student/in", fa: "ÿØÿßŸÜÿ¥ÿ¨Ÿà", um: "dƒÅne≈°«ß≈´" },
            { de: "der Morgen", fa: "ÿµŸèÿ®ÿ≠", um: "sobh" },
            { de: "die Uhr/Stunde", fa: "ÿ≥ÿßÿπÿ™", um: "sƒÅ øat" },
            { de: "das Fr√ºhst√ºck", fa: "ÿµŸèÿ®ÿ≠ÿßŸÜŸá", um: "sob·∏•ƒÅne" },
            { de: "das Mittagessen", fa: "ŸÜÿßŸáÿßÿ±", um: "nƒÅhƒÅr" },
            { de: "das Abendessen", fa: "ÿ¥ÿßŸÖ", um: "≈°ƒÅm" },
            { de: "der Kaffee", fa: "ŸÇŸéŸáŸàŸêŸá", um: "qahve" },
            { de: "der Tee", fa: "⁄Üÿß€å", um: "ƒçƒÅy" },
            { de: "das Wasser", fa: "ÿ¢ÿ®", um: "ƒÅb" },
            { de: "das Obst", fa: "ŸÖ€åŸàŸêŸá", um: "mƒ´ve" },
            { de: "das Brot", fa: "ŸÜÿßŸÜ", um: "nƒÅn" },
            { de: "der Reis", fa: "ÿ®ÿ±ŸÜÿ¨", um: "beren«ß" },
            { de: "das Haus", fa: "ÿÆÿßŸÜŸêŸá", um: "·∏´ƒÅne" },
            { de: "die Universit√§t", fa: "ÿØÿßŸÜŸêÿ¥⁄ØÿßŸá", um: "dƒÅne≈°gƒÅh" },
            { de: "die Schule", fa: "ŸÖÿØÿ±ÿ≥Ÿá", um: "madrese" },
            { de: "die Bibliothek", fa: "⁄©Ÿêÿ™ÿßÿ®ÿÆÿßŸÜŸá", um: "ketƒÅb·∏´ƒÅne" },
            { de: "der Unterricht", fa: "⁄©ŸêŸÑÿßÿ≥", um: "kelƒÅs" },
            { de: "das Buch", fa: "⁄©Ÿêÿ™ÿßÿ®", um: "ketƒÅb" },
            { de: "der/die Freund/in", fa: "ÿØŸàÿ≥ÿ™", um: "dust" },
            { de: "der/die Lehrer/in", fa: "ŸÖÿπŸÑŸÖ", um: "mo øallem" },
            { de: "die Musik", fa: "ŸÖŸàÿ≥€åŸÇ€å", um: "m≈´sƒ´qƒ´" },
            { de: "der Film", fa: "ŸÅ€åŸÑŸÖ", um: "fƒ´lm" },
            { de: "gestern", fa: "ÿØ€åÿ±Ÿàÿ≤", um: "dƒ´r≈´z" },
            { de: "heute", fa: "ÿßŸÖÿ±Ÿàÿ≤", um: "emr≈´z" },
            { de: "morgen", fa: "ŸÅÿ±ÿØÿß", um: "fardƒÅ" },
            { de: "dann, danach", fa: "ÿ®ŸéÿπÿØ", um: "ba ød" },
            { de: "mit", fa: "ÿ®ÿß", um: "bƒÅ" },
            { de: "in", fa: "ÿØŸéÿ±", um: "dar" },
            { de: "zu, nach", fa: "ÿ®Ÿá", um: "be" },
            { de: "f√ºr", fa: "ÿ®ÿ±ÿß€å", um: "barƒÅye" },
            { de: "wie viele", fa: "⁄ÜŸéŸÜÿØ", um: "ƒçand" },
            { de: "was", fa: "⁄ÜŸêŸá / ⁄Ü€å", um: "ƒçe / ƒçƒ´" },
            { de: "wann", fa: "⁄©ŸêŸÄ€å", um: "key" },
            { de: "wo", fa: "⁄©Ÿèÿ¨ÿß", um: "kojƒÅ" },
            { de: "ich", fa: "ŸÖŸÜ", um: "man" },
            { de: "du", fa: "ÿ™Ÿà", um: "to" },
            { de: "er/sie", fa: "ÿßŸà", um: "u" },
            { de: "wir", fa: "ŸÖÿß", um: "mƒÅ" },
            { de: "ihr/Sie", fa: "ÿ¥ŸÖÿß", um: "≈°omƒÅ" },
            { de: "sie (Plural)", fa: "ÿ¢ŸÜŸáÿß", um: "ƒÅnhƒÅ" }
        ];

        // Verben f√ºr Pr√§teritum
        const verbs = [
            { inf: "ÿ®ŸàÿØŸéŸÜ", um: "budan", de: "sein", stamm: "ÿ®ŸàÿØ", stammUm: "bud" },
            { inf: "ÿ±ŸéŸÅÿ™ŸÜ", um: "raftan", de: "gehen", stamm: "ÿ±ŸéŸÅÿ™", stammUm: "raft" },
            { inf: "ÿÆŸàÿ±ÿØŸéŸÜ", um: "·∏´ordan", de: "essen", stamm: "ÿÆŸàÿ±ÿØ", stammUm: "·∏´ord" },
            { inf: "ŸÜŸàÿ¥€åÿØŸéŸÜ", um: "nu≈°ƒ´dan", de: "trinken", stamm: "ŸÜŸàÿ¥€åÿØ", stammUm: "nu≈°ƒ´d" },
            { inf: "ÿÆŸàÿßŸÜÿØŸéŸÜ", um: "·∏´ƒÅndan", de: "lesen", stamm: "ÿÆŸàÿßŸÜÿØ", stammUm: "·∏´ƒÅnd" },
            { inf: "ÿØÿßÿ¥ÿ™ŸéŸÜ", um: "dƒÅ≈°tan", de: "haben", stamm: "ÿØÿßÿ¥ÿ™", stammUm: "dƒÅ≈°t" },
            { inf: "⁄ØŸèŸÅÿ™ŸéŸÜ", um: "goftan", de: "sagen", stamm: "⁄ØŸèŸÅÿ™", stammUm: "goft" },
            { inf: "ÿ¥ŸêŸÜ€åÿØŸéŸÜ", um: "≈°enƒ´dan", de: "h√∂ren", stamm: "ÿ¥ŸêŸÜ€åÿØ", stammUm: "≈°enƒ´d" },
            { inf: "ÿØŸèÿ±Ÿèÿ≥ÿ™ ⁄©Ÿéÿ±ÿØŸéŸÜ", um: "dorost kardan", de: "machen/kochen", stamm: "ÿØŸèÿ±Ÿèÿ≥ÿ™ ⁄©Ÿéÿ±ÿØ", stammUm: "dorost kard" },
            { inf: "ÿÆŸéÿ±€åÿØŸéŸÜ", um: "·∏´arƒ´dan", de: "kaufen", stamm: "ÿÆŸéÿ±€åÿØ", stammUm: "·∏´arƒ´d" },
            { inf: "ÿÆŸàÿßÿ®€åÿØŸéŸÜ", um: "·∏´ƒÅbƒ´dan", de: "schlafen", stamm: "ÿÆŸàÿßÿ®€åÿØ", stammUm: "·∏´ƒÅbƒ´d" },
            { inf: "ÿ®Ÿéÿ±⁄ØŸéÿ¥ÿ™ŸéŸÜ", um: "barga≈°tan", de: "zur√ºckkehren", stamm: "ÿ®Ÿéÿ±⁄ØŸéÿ¥ÿ™", stammUm: "barga≈°t" },
            { inf: "ÿ®€åÿØÿßÿ± ÿ¥ŸèÿØŸéŸÜ", um: "bidƒÅr ≈°odan", de: "aufwachen", stamm: "ÿ®€åÿØÿßÿ± ÿ¥ŸèÿØ", stammUm: "bidƒÅr ≈°od" },
            { inf: "⁄ØŸàÿ¥ ÿØÿßÿØŸÜ", um: "gu≈° dƒÅdan", de: "zuh√∂ren", stamm: "⁄ØŸàÿ¥ ÿØÿßÿØ", stammUm: "gu≈° dƒÅd" },
            { inf: "ÿØ€åÿØŸéŸÜ", um: "dƒ´dan", de: "sehen", stamm: "ÿØ€åÿØ", stammUm: "dƒ´d" },
            { inf: "ÿ¢ŸÖŸéÿØŸéŸÜ", um: "ƒÅmadan", de: "kommen", stamm: "ÿ¢ŸÖÿØ", stammUm: "ƒÅmad" }
        ];

        // Pr√§teritum Endungen
        const endings = {
            "ŸÖŸÜ": { end: "ŸéŸÖ", endUm: "am" },
            "ÿ™Ÿà": { end: "€å", endUm: "ƒ´" },
            "ÿßŸà": { end: "", endUm: "" },
            "ŸÖÿß": { end: "€åŸÖ", endUm: "ƒ´m" },
            "ÿ¥ŸÖÿß": { end: "€åÿØ", endUm: "ƒ´d" },
            "ÿ¢ŸÜŸáÿß": { end: "ŸéŸÜÿØ", endUm: "and" }
        };

        // Pr√§sens Endungen f√ºr haben und sein
        const presentEndings = {
            "ŸÖŸÜ": { end: "ŸÖ", endUm: "am" },
            "ÿ™Ÿà": { end: "€å", endUm: "ƒ´" },
            "ÿßŸà": { end: "", endUm: "" },
            "ŸÖÿß": { end: "€åŸÖ", endUm: "ƒ´m" },
            "ÿ¥ŸÖÿß": { end: "€åÿØ", endUm: "ƒ´d" },
            "ÿ¢ŸÜŸáÿß": { end: "ŸÜÿØ", endUm: "and" }
        };

        // Pr√§sens von haben (dƒÅ≈°tan) und sein (budan)
        const presentForms = {
            budan: { // sein - Pr√§sens: Ÿáÿ≥ÿ™ŸÖÿå Ÿáÿ≥ÿ™€åÿå ÿßÿ≥ÿ™/Ÿáÿ≥ÿ™ÿå Ÿáÿ≥ÿ™€åŸÖÿå Ÿáÿ≥ÿ™€åÿØÿå Ÿáÿ≥ÿ™ŸÜÿØ
                "ŸÖŸÜ": "Ÿáÿ≥ÿ™ŸÖ",
                "ÿ™Ÿà": "Ÿáÿ≥ÿ™€å",
                "ÿßŸà": "ÿßÿ≥ÿ™",
                "ŸÖÿß": "Ÿáÿ≥ÿ™€åŸÖ",
                "ÿ¥ŸÖÿß": "Ÿáÿ≥ÿ™€åÿØ",
                "ÿ¢ŸÜŸáÿß": "Ÿáÿ≥ÿ™ŸÜÿØ"
            },
            dƒÅ≈°tan: { // haben - Pr√§sens: ÿØÿßÿ±ŸÖÿå ÿØÿßÿ±€åÿå ÿØÿßÿ±ÿØÿå ÿØÿßÿ±€åŸÖÿå ÿØÿßÿ±€åÿØÿå ÿØÿßÿ±ŸÜÿØ
                "ŸÖŸÜ": "ÿØÿßÿ±ŸÖ",
                "ÿ™Ÿà": "ÿØÿßÿ±€å",
                "ÿßŸà": "ÿØÿßÿ±ÿØ",
                "ŸÖÿß": "ÿØÿßÿ±€åŸÖ",
                "ÿ¥ŸÖÿß": "ÿØÿßÿ±€åÿØ",
                "ÿ¢ŸÜŸáÿß": "ÿØÿßÿ±ŸÜÿØ"
            }
        };

        const pronounsDE = {
            "ŸÖŸÜ": "ich",
            "ÿ™Ÿà": "du",
            "ÿßŸà": "er/sie",
            "ŸÖÿß": "wir",
            "ÿ¥ŸÖÿß": "ihr/Sie",
            "ÿ¢ŸÜŸáÿß": "sie (Plural)"
        };

        // ===================== GLOBAL STATE =====================
        let currentExercise = 0;
        let exerciseState = {};

        // ===================== NAVIGATION =====================
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function goHome() {
            currentExercise = 0;
            document.getElementById('current-exercise').textContent = '√úbungscamp Pr√§teritum';
            showScreen('home-screen');
        }

        function restartExercise() {
            if (currentExercise === -1) {
                startVocabTraining();
            } else if (currentExercise === -2) {
                startVerbTraining();
            } else if (currentExercise > 0) {
                startExercise(currentExercise);
            }
        }

        function startExercise(num) {
            currentExercise = num;
            const titles = ['', '√úbung 1: Matching', '√úbung 2: S√§tze', '√úbung 3: Konjugation', '√úbung 4: Pr√§teritum'];
            document.getElementById('current-exercise').textContent = titles[num];
            
            if (num === 1) initExercise1();
            else if (num === 2) initExercise2();
            else if (num === 3) initExercise3();
            else if (num === 4) initExercise4();
            
            showScreen(`exercise${num}-screen`);
        }

        // ===================== √úBUNG 1: MATCHING =====================
        function initExercise1() {
            exerciseState = {
                round: 1,
                totalMatched: 0,
                currentMatched: 0,
                selectedGerman: null,
                selectedPersian: null,
                currentPairs: [],
                usedIndices: []
            };
            loadMatchingRound();
        }

        function loadMatchingRound() {
            const state = exerciseState;
            state.currentMatched = 0;
            state.selectedGerman = null;
            state.selectedPersian = null;
            
            // W√§hle bis zu 6 zuf√§llige Vokabeln, die noch nicht verwendet wurden
            let pool = vocabulary.filter((v, i) => !state.usedIndices.includes(i));
            
            if (pool.length === 0) {
                // Alle verwendet - √úbung beendet
                showCertificate(1);
                return;
            }
            
            shuffleArray(pool);
            const numCards = Math.min(6, pool.length);
            state.currentPairs = pool.slice(0, numCards);
            state.cardsThisRound = numCards;
            
            // Merke verwendete Indizes
            state.currentPairs.forEach(pair => {
                const idx = vocabulary.findIndex(v => v.de === pair.de);
                if (idx !== -1) state.usedIndices.push(idx);
            });
            
            // Render
            const germanDiv = document.getElementById('german-words');
            const persianDiv = document.getElementById('persian-words');
            
            const germanOrder = [...state.currentPairs];
            const persianOrder = [...state.currentPairs];
            shuffleArray(germanOrder);
            shuffleArray(persianOrder);
            
            germanDiv.innerHTML = germanOrder.map((v, i) => 
                `<div class="match-item" data-de="${v.de}" onclick="selectGerman(this)">${v.de}</div>`
            ).join('');
            
            persianDiv.innerHTML = persianOrder.map((v, i) => 
                `<div class="match-item persian" data-de="${v.de}" onclick="selectPersian(this)">
                    ${v.fa}<br><span class="umschrift" style="font-size: 0.75em;">${v.um}</span>
                </div>`
            ).join('');
            
            document.getElementById('e1-round').textContent = state.round;
            document.getElementById('e1-matched').textContent = state.totalMatched;
            document.getElementById('e1-next-btn').disabled = true;
        }

        function selectGerman(el) {
            if (el.classList.contains('matched')) return;
            
            document.querySelectorAll('#german-words .match-item').forEach(e => {
                if (!e.classList.contains('matched')) e.classList.remove('selected');
            });
            el.classList.add('selected');
            exerciseState.selectedGerman = el.dataset.de;
            
            checkMatch();
        }

        function selectPersian(el) {
            if (el.classList.contains('matched')) return;
            
            document.querySelectorAll('#persian-words .match-item').forEach(e => {
                if (!e.classList.contains('matched')) e.classList.remove('selected');
            });
            el.classList.add('selected');
            exerciseState.selectedPersian = el.dataset.de;
            
            checkMatch();
        }

        function checkMatch() {
            const state = exerciseState;
            if (!state.selectedGerman || !state.selectedPersian) return;
            
            const germanEl = document.querySelector(`#german-words .match-item[data-de="${state.selectedGerman}"]`);
            const persianEl = document.querySelector(`#persian-words .match-item[data-de="${state.selectedPersian}"]`);
            
            if (state.selectedGerman === state.selectedPersian) {
                // Richtig!
                germanEl.classList.remove('selected');
                persianEl.classList.remove('selected');
                germanEl.classList.add('matched', 'correct');
                persianEl.classList.add('matched', 'correct');
                
                state.currentMatched++;
                state.totalMatched++;
                document.getElementById('e1-matched').textContent = state.totalMatched;
                
                if (state.currentMatched >= state.cardsThisRound) {
                    // Pr√ºfe ob noch Vokabeln √ºbrig sind
                    const remaining = vocabulary.filter((v, i) => !state.usedIndices.includes(i));
                    if (remaining.length === 0) {
                        setTimeout(() => showCertificate(1), 500);
                    } else {
                        document.getElementById('e1-next-btn').disabled = false;
                    }
                }
            } else {
                // Falsch
                germanEl.classList.add('wrong');
                persianEl.classList.add('wrong');
                setTimeout(() => {
                    germanEl.classList.remove('wrong', 'selected');
                    persianEl.classList.remove('wrong', 'selected');
                }, 500);
            }
            
            state.selectedGerman = null;
            state.selectedPersian = null;
        }

        function nextMatchingRound() {
            exerciseState.round++;
            loadMatchingRound();
        }

        // ===================== VOKABELTRAINING (ENDLOS) =====================
        let vtState = {};
        
        function startVocabTraining() {
            currentExercise = -1; // Spezieller Modus
            document.getElementById('current-exercise').textContent = 'Vokabeltraining';
            
            vtState = {
                pool: shuffleArray([...vocabulary]),
                currentPairs: [],
                cardsThisRound: 6,
                currentMatched: 0,
                totalCorrect: 0,
                totalAttempts: 0,
                selectedGerman: null,
                selectedPersian: null
            };
            
            loadVTRound();
            showScreen('vocab-training-screen');
        }
        
        function loadVTRound() {
            vtState.currentMatched = 0;
            vtState.selectedGerman = null;
            vtState.selectedPersian = null;
            
            // Wenn Pool leer, neu mischen
            if (vtState.pool.length < 6) {
                vtState.pool = shuffleArray([...vocabulary]);
            }
            
            const numCards = Math.min(6, vtState.pool.length);
            vtState.currentPairs = vtState.pool.splice(0, numCards);
            vtState.cardsThisRound = numCards;
            
            // Render
            const germanDiv = document.getElementById('vt-german-words');
            const persianDiv = document.getElementById('vt-persian-words');
            
            const germanOrder = shuffleArray([...vtState.currentPairs]);
            const persianOrder = shuffleArray([...vtState.currentPairs]);
            
            germanDiv.innerHTML = germanOrder.map((v, i) => 
                `<div class="match-item" data-de="${v.de}" onclick="selectVTGerman(this)">${v.de}</div>`
            ).join('');
            
            persianDiv.innerHTML = persianOrder.map((v, i) => 
                `<div class="match-item persian" data-de="${v.de}" onclick="selectVTPersian(this)">
                    ${v.fa}<br><span class="umschrift" style="font-size: 0.75em;">${v.um}</span>
                </div>`
            ).join('');
            
            updateVTStats();
            document.getElementById('vt-next-btn').disabled = true;
        }
        
        function updateVTStats() {
            document.getElementById('vt-correct').textContent = vtState.totalCorrect;
            document.getElementById('vt-total').textContent = vtState.totalAttempts;
            document.getElementById('vt-remaining').textContent = vtState.pool.length;
        }
        
        function selectVTGerman(el) {
            if (el.classList.contains('matched')) return;
            
            document.querySelectorAll('#vt-german-words .match-item').forEach(e => {
                if (!e.classList.contains('matched')) e.classList.remove('selected');
            });
            el.classList.add('selected');
            vtState.selectedGerman = el.dataset.de;
            
            checkVTMatch();
        }
        
        function selectVTPersian(el) {
            if (el.classList.contains('matched')) return;
            
            document.querySelectorAll('#vt-persian-words .match-item').forEach(e => {
                if (!e.classList.contains('matched')) e.classList.remove('selected');
            });
            el.classList.add('selected');
            vtState.selectedPersian = el.dataset.de;
            
            checkVTMatch();
        }
        
        function checkVTMatch() {
            if (!vtState.selectedGerman || !vtState.selectedPersian) return;
            
            const germanEl = document.querySelector(`#vt-german-words .match-item[data-de="${vtState.selectedGerman}"]`);
            const persianEl = document.querySelector(`#vt-persian-words .match-item[data-de="${vtState.selectedPersian}"]`);
            
            vtState.totalAttempts++;
            
            if (vtState.selectedGerman === vtState.selectedPersian) {
                // Richtig!
                germanEl.classList.remove('selected');
                persianEl.classList.remove('selected');
                germanEl.classList.add('matched', 'correct');
                persianEl.classList.add('matched', 'correct');
                
                vtState.currentMatched++;
                vtState.totalCorrect++;
                
                if (vtState.currentMatched >= vtState.cardsThisRound) {
                    document.getElementById('vt-next-btn').disabled = false;
                }
            } else {
                // Falsch - Karte zur√ºck in den Pool
                const wrongCard = vocabulary.find(v => v.de === vtState.selectedGerman);
                if (wrongCard) {
                    vtState.pool.push(wrongCard);
                }
                
                germanEl.classList.add('wrong');
                persianEl.classList.add('wrong');
                setTimeout(() => {
                    germanEl.classList.remove('wrong', 'selected');
                    persianEl.classList.remove('wrong', 'selected');
                }, 500);
            }
            
            updateVTStats();
            vtState.selectedGerman = null;
            vtState.selectedPersian = null;
        }
        
        function nextVTRound() {
            loadVTRound();
        }

        // ===================== VERB-KONJUGATION TRAINING (ENDLOS) =====================
        let vbtState = {};
        
        function startVerbTraining() {
            currentExercise = -2; // Spezieller Modus f√ºr Verb-Training
            document.getElementById('current-exercise').textContent = 'Verb-Training';
            
            vbtState = {
                verbPool: shuffleArray([...verbs]),
                currentVerb: null,
                currentPairs: [],
                currentMatched: 0,
                totalCorrect: 0,
                totalAttempts: 0,
                verbCount: 0,
                selectedPronoun: null,
                selectedVerb: null
            };
            
            loadVerbTrainingRound();
            showScreen('verb-training-screen');
        }
        
        function loadVerbTrainingRound() {
            vbtState.currentMatched = 0;
            vbtState.selectedPronoun = null;
            vbtState.selectedVerb = null;
            
            // Wenn Pool leer, neu mischen
            if (vbtState.verbPool.length === 0) {
                vbtState.verbPool = shuffleArray([...verbs]);
            }
            
            // W√§hle ein Verb
            vbtState.currentVerb = vbtState.verbPool.pop();
            vbtState.verbCount++;
            
            const verb = vbtState.currentVerb;
            const pronouns = ["ŸÖŸÜ", "ÿ™Ÿà", "ÿßŸà", "ŸÖÿß", "ÿ¥ŸÖÿß", "ÿ¢ŸÜŸáÿß"];
            
            // Generiere alle konjugierten Formen
            vbtState.currentPairs = pronouns.map(pronoun => {
                const ending = endings[pronoun];
                return {
                    pronoun: pronoun,
                    conjugated: verb.stamm + ending.end,
                    pronounDE: pronounsDE[pronoun]
                };
            });
            
            // Zeige Verb-Info
            document.getElementById('verb-training-verb').innerHTML = 
                `<span style="color: #ffa502;">${verb.inf}</span> (${verb.de})`;
            
            // Render
            const pronounsDiv = document.getElementById('vbt-pronouns');
            const verbsDiv = document.getElementById('vbt-verbs');
            
            const shuffledPronouns = shuffleArray([...vbtState.currentPairs]);
            const shuffledVerbs = shuffleArray([...vbtState.currentPairs]);
            
            pronounsDiv.innerHTML = shuffledPronouns.map(p => 
                `<div class="match-item persian" data-pronoun="${p.pronoun}" onclick="selectVBTPronoun(this)">
                    ${p.pronoun}<br><span class="umschrift" style="font-size: 0.7em;">${p.pronounDE}</span>
                </div>`
            ).join('');
            
            verbsDiv.innerHTML = shuffledVerbs.map(p => 
                `<div class="match-item persian" data-pronoun="${p.pronoun}" onclick="selectVBTVerb(this)">${p.conjugated}</div>`
            ).join('');
            
            updateVBTStats();
            document.getElementById('vbt-next-btn').disabled = true;
        }
        
        function updateVBTStats() {
            document.getElementById('vbt-correct').textContent = vbtState.totalCorrect;
            document.getElementById('vbt-total').textContent = vbtState.totalAttempts;
            document.getElementById('vbt-verb-count').textContent = vbtState.verbCount;
        }
        
        function selectVBTPronoun(el) {
            if (el.classList.contains('matched')) return;
            
            document.querySelectorAll('#vbt-pronouns .match-item').forEach(e => {
                if (!e.classList.contains('matched')) e.classList.remove('selected');
            });
            el.classList.add('selected');
            vbtState.selectedPronoun = el.dataset.pronoun;
            
            checkVBTMatch();
        }
        
        function selectVBTVerb(el) {
            if (el.classList.contains('matched')) return;
            
            document.querySelectorAll('#vbt-verbs .match-item').forEach(e => {
                if (!e.classList.contains('matched')) e.classList.remove('selected');
            });
            el.classList.add('selected');
            vbtState.selectedVerb = el.dataset.pronoun; // data-pronoun enth√§lt die richtige Zuordnung
            
            checkVBTMatch();
        }
        
        function checkVBTMatch() {
            if (!vbtState.selectedPronoun || !vbtState.selectedVerb) return;
            
            const pronounEl = document.querySelector(`#vbt-pronouns .match-item[data-pronoun="${vbtState.selectedPronoun}"]`);
            const verbEl = document.querySelector(`#vbt-verbs .match-item.selected`);
            
            vbtState.totalAttempts++;
            
            if (vbtState.selectedPronoun === vbtState.selectedVerb) {
                // Richtig!
                pronounEl.classList.remove('selected');
                verbEl.classList.remove('selected');
                pronounEl.classList.add('matched', 'correct');
                verbEl.classList.add('matched', 'correct');
                
                vbtState.currentMatched++;
                vbtState.totalCorrect++;
                
                if (vbtState.currentMatched >= 6) {
                    document.getElementById('vbt-next-btn').disabled = false;
                }
            } else {
                // Falsch
                pronounEl.classList.add('wrong');
                verbEl.classList.add('wrong');
                setTimeout(() => {
                    pronounEl.classList.remove('wrong', 'selected');
                    verbEl.classList.remove('wrong', 'selected');
                }, 500);
            }
            
            updateVBTStats();
            vbtState.selectedPronoun = null;
            vbtState.selectedVerb = null;
        }
        
        function nextVerbTrainingRound() {
            loadVerbTrainingRound();
        }

        // ===================== √úBUNG 2: MULTIPLE CHOICE / WORD BANK =====================
        const exercise2Questions = [
            // Multiple Choice - Original
            { type: 'mc', de: 'Ich ging zur Universit√§t.', correct: 'ŸÖŸÜ ÿ®Ÿá ÿØÿßŸÜÿ¥⁄ØÿßŸá ÿ±ŸÅÿ™ŸÖ.', options: ['ŸÖŸÜ ÿ®Ÿá ÿØÿßŸÜÿ¥⁄ØÿßŸá ÿ±ŸÅÿ™ŸÖ.', 'ÿ™Ÿà ÿ®Ÿá ÿØÿßŸÜÿ¥⁄ØÿßŸá ÿ±ŸÅÿ™€å.', 'ÿßŸà ÿ®Ÿá ÿÆÿßŸÜŸá ÿ±ŸÅÿ™.', 'ŸÖÿß ŸÜÿßŸÜ ÿÆŸàÿ±ÿØ€åŸÖ.'] },
            { type: 'mc', de: 'Er las ein Buch.', correct: 'ÿßŸà €å⁄© ⁄©ÿ™ÿßÿ® ÿÆŸàÿßŸÜÿØ.', options: ['ÿßŸà €å⁄© ⁄©ÿ™ÿßÿ® ÿÆŸàÿßŸÜÿØ.', 'ŸÖŸÜ €å⁄© ⁄©ÿ™ÿßÿ® ÿÆŸàÿßŸÜÿØŸÖ.', 'ÿßŸà ŸÇŸáŸàŸá ŸÜŸàÿ¥€åÿØ.', 'ŸÖÿß ŸÅ€åŸÑŸÖ ÿØ€åÿØ€åŸÖ.'] },
            { type: 'mc', de: 'Wir tranken Kaffee.', correct: 'ŸÖÿß ŸÇŸáŸàŸá ŸÜŸàÿ¥€åÿØ€åŸÖ.', options: ['ŸÖÿß ŸÇŸáŸàŸá ŸÜŸàÿ¥€åÿØ€åŸÖ.', 'ÿ¥ŸÖÿß ŸÇŸáŸàŸá ŸÜŸàÿ¥€åÿØ€åÿØ.', 'ÿ¢ŸÜŸáÿß ⁄Üÿß€å ÿÆŸàÿ±ÿØŸÜÿØ.', 'ŸÖŸÜ ÿ¢ÿ® ŸÜŸàÿ¥€åÿØŸÖ.'] },
            { type: 'mc', de: 'Du hattest einen Freund.', correct: 'ÿ™Ÿà €å⁄© ÿØŸàÿ≥ÿ™ ÿØÿßÿ¥ÿ™€å.', options: ['ÿ™Ÿà €å⁄© ÿØŸàÿ≥ÿ™ ÿØÿßÿ¥ÿ™€å.', 'ÿßŸà €å⁄© ÿØŸàÿ≥ÿ™ ÿØÿßÿ¥ÿ™.', 'ŸÖŸÜ €å⁄© ÿ®ÿ±ÿßÿØÿ± ÿØÿßÿ¥ÿ™ŸÖ.', 'ŸÖÿß ÿØŸàÿ≥ÿ™ ÿØÿßÿ¥ÿ™€åŸÖ.'] },
            { type: 'mc', de: 'Sie (Pl.) kehrten nach Hause zur√ºck.', correct: 'ÿ¢ŸÜŸáÿß ÿ®Ÿá ÿÆÿßŸÜŸá ÿ®ÿ±⁄Øÿ¥ÿ™ŸÜÿØ.', options: ['ÿ¢ŸÜŸáÿß ÿ®Ÿá ÿÆÿßŸÜŸá ÿ®ÿ±⁄Øÿ¥ÿ™ŸÜÿØ.', 'ŸÖÿß ÿ®Ÿá ÿÆÿßŸÜŸá ÿ®ÿ±⁄Øÿ¥ÿ™€åŸÖ.', 'ÿßŸà ÿ®Ÿá ÿÆÿßŸÜŸá ÿ®ÿ±⁄Øÿ¥ÿ™.', 'ÿ¥ŸÖÿß ÿ®Ÿá ÿÆÿßŸÜŸá ÿ®ÿ±⁄Øÿ¥ÿ™€åÿØ.'] },
            { type: 'mc', de: 'Mein Vater kaufte Brot.', correct: 'ŸæÿØÿ± ŸÖŸÜ ŸÜÿßŸÜ ÿÆÿ±€åÿØ.', options: ['ŸæÿØÿ± ŸÖŸÜ ŸÜÿßŸÜ ÿÆÿ±€åÿØ.', 'ŸÖÿßÿØÿ± ŸÖŸÜ ŸÜÿßŸÜ ÿÆÿ±€åÿØ.', 'ŸÖŸÜ ŸÜÿßŸÜ ÿÆÿ±€åÿØŸÖ.', 'ŸæÿØÿ± ŸÖŸÜ ŸÖ€åŸàŸá ÿÆÿ±€åÿØ.'] },
            { type: 'mc', de: 'Die Kinder schliefen.', correct: 'ÿ®⁄ÜŸá‚ÄåŸáÿß ÿÆŸàÿßÿ®€åÿØŸÜÿØ.', options: ['ÿ®⁄ÜŸá‚ÄåŸáÿß ÿÆŸàÿßÿ®€åÿØŸÜÿØ.', 'ÿ®⁄ÜŸá ÿÆŸàÿßÿ®€åÿØ.', 'ŸÖÿß ÿÆŸàÿßÿ®€åÿØ€åŸÖ.', 'ÿ¢ŸÜŸáÿß ÿ®€åÿØÿßÿ± ÿ¥ÿØŸÜÿØ.'] },
            { type: 'mc', de: 'Ich wachte um 6 Uhr auf.', correct: 'ŸÖŸÜ ÿ≥ÿßÿπÿ™ ÿ¥ÿ¥ ÿ®€åÿØÿßÿ± ÿ¥ÿØŸÖ.', options: ['ŸÖŸÜ ÿ≥ÿßÿπÿ™ ÿ¥ÿ¥ ÿ®€åÿØÿßÿ± ÿ¥ÿØŸÖ.', 'ÿ™Ÿà ÿ≥ÿßÿπÿ™ ÿ¥ÿ¥ ÿ®€åÿØÿßÿ± ÿ¥ÿØ€å.', 'ÿßŸà ÿ≥ÿßÿπÿ™ ŸáŸÅÿ™ ÿ®€åÿØÿßÿ± ÿ¥ÿØ.', 'ŸÖÿß ÿ≥ÿßÿπÿ™ ÿØŸá ÿ®€åÿØÿßÿ± ÿ¥ÿØ€åŸÖ.'] },
            // Multiple Choice - Verdoppelt/Neu
            { type: 'mc', de: 'Du gingst zur Schule.', correct: 'ÿ™Ÿà ÿ®Ÿá ŸÖÿØÿ±ÿ≥Ÿá ÿ±ŸÅÿ™€å.', options: ['ÿ™Ÿà ÿ®Ÿá ŸÖÿØÿ±ÿ≥Ÿá ÿ±ŸÅÿ™€å.', 'ŸÖŸÜ ÿ®Ÿá ŸÖÿØÿ±ÿ≥Ÿá ÿ±ŸÅÿ™ŸÖ.', 'ÿßŸà ÿ®Ÿá ŸÖÿØÿ±ÿ≥Ÿá ÿ±ŸÅÿ™.', 'ŸÖÿß ÿ®Ÿá ŸÖÿØÿ±ÿ≥Ÿá ÿ±ŸÅÿ™€åŸÖ.'] },
            { type: 'mc', de: 'Sie (er/sie) h√∂rte Musik.', correct: 'ÿßŸà ŸÖŸàÿ≥€åŸÇ€å ÿ¥ŸÜ€åÿØ.', options: ['ÿßŸà ŸÖŸàÿ≥€åŸÇ€å ÿ¥ŸÜ€åÿØ.', 'ŸÖŸÜ ŸÖŸàÿ≥€åŸÇ€å ÿ¥ŸÜ€åÿØŸÖ.', 'ÿ™Ÿà ŸÖŸàÿ≥€åŸÇ€å ÿ¥ŸÜ€åÿØ€å.', 'ÿ¢ŸÜŸáÿß ŸÖŸàÿ≥€åŸÇ€å ÿ¥ŸÜ€åÿØŸÜÿØ.'] },
            { type: 'mc', de: 'Wir lasen ein Buch.', correct: 'ŸÖÿß €å⁄© ⁄©ÿ™ÿßÿ® ÿÆŸàÿßŸÜÿØ€åŸÖ.', options: ['ŸÖÿß €å⁄© ⁄©ÿ™ÿßÿ® ÿÆŸàÿßŸÜÿØ€åŸÖ.', 'ÿ¥ŸÖÿß €å⁄© ⁄©ÿ™ÿßÿ® ÿÆŸàÿßŸÜÿØ€åÿØ.', 'ÿ¢ŸÜŸáÿß €å⁄© ⁄©ÿ™ÿßÿ® ÿÆŸàÿßŸÜÿØŸÜÿØ.', 'ŸÖŸÜ €å⁄© ⁄©ÿ™ÿßÿ® ÿÆŸàÿßŸÜÿØŸÖ.'] },
            { type: 'mc', de: 'Ihr sagtet Hallo.', correct: 'ÿ¥ŸÖÿß ÿ≥ŸÑÿßŸÖ ⁄ØŸÅÿ™€åÿØ.', options: ['ÿ¥ŸÖÿß ÿ≥ŸÑÿßŸÖ ⁄ØŸÅÿ™€åÿØ.', 'ŸÖÿß ÿ≥ŸÑÿßŸÖ ⁄ØŸÅÿ™€åŸÖ.', 'ÿ¢ŸÜŸáÿß ÿ≥ŸÑÿßŸÖ ⁄ØŸÅÿ™ŸÜÿØ.', 'ÿ™Ÿà ÿ≥ŸÑÿßŸÖ ⁄ØŸÅÿ™€å.'] },
            { type: 'mc', de: 'Ich hatte zwei Br√ºder.', correct: 'ŸÖŸÜ ÿØŸà ÿ®ÿ±ÿßÿØÿ± ÿØÿßÿ¥ÿ™ŸÖ.', options: ['ŸÖŸÜ ÿØŸà ÿ®ÿ±ÿßÿØÿ± ÿØÿßÿ¥ÿ™ŸÖ.', 'ÿ™Ÿà ÿØŸà ÿ®ÿ±ÿßÿØÿ± ÿØÿßÿ¥ÿ™€å.', 'ÿßŸà ÿØŸà ÿ®ÿ±ÿßÿØÿ± ÿØÿßÿ¥ÿ™.', 'ŸÖÿß ÿØŸà ÿ®ÿ±ÿßÿØÿ± ÿØÿßÿ¥ÿ™€åŸÖ.'] },
            { type: 'mc', de: 'Meine Mutter kochte das Mittagessen.', correct: 'ŸÖÿßÿØÿ± ŸÖŸÜ ŸÜÿßŸáÿßÿ± ÿØÿ±ÿ≥ÿ™ ⁄©ÿ±ÿØ.', options: ['ŸÖÿßÿØÿ± ŸÖŸÜ ŸÜÿßŸáÿßÿ± ÿØÿ±ÿ≥ÿ™ ⁄©ÿ±ÿØ.', 'ŸæÿØÿ± ŸÖŸÜ ŸÜÿßŸáÿßÿ± ÿØÿ±ÿ≥ÿ™ ⁄©ÿ±ÿØ.', 'ŸÖŸÜ ŸÜÿßŸáÿßÿ± ÿØÿ±ÿ≥ÿ™ ⁄©ÿ±ÿØŸÖ.', 'ŸÖÿßÿØÿ± ŸÖŸÜ ÿ¥ÿßŸÖ ÿØÿ±ÿ≥ÿ™ ⁄©ÿ±ÿØ.'] },
            { type: 'mc', de: 'Die Schwester kaufte Obst.', correct: 'ÿÆŸàÿßŸáÿ± ŸÖ€åŸàŸá ÿÆÿ±€åÿØ.', options: ['ÿÆŸàÿßŸáÿ± ŸÖ€åŸàŸá ÿÆÿ±€åÿØ.', 'ÿ®ÿ±ÿßÿØÿ± ŸÖ€åŸàŸá ÿÆÿ±€åÿØ.', 'ÿÆŸàÿßŸáÿ± ŸÜÿßŸÜ ÿÆÿ±€åÿØ.', 'ŸÖŸÜ ŸÖ€åŸàŸá ÿÆÿ±€åÿØŸÖ.'] },
            { type: 'mc', de: 'Er/Sie kam nach Hause.', correct: 'ÿßŸà ÿ®Ÿá ÿÆÿßŸÜŸá ÿ¢ŸÖÿØ.', options: ['ÿßŸà ÿ®Ÿá ÿÆÿßŸÜŸá ÿ¢ŸÖÿØ.', 'ŸÖŸÜ ÿ®Ÿá ÿÆÿßŸÜŸá ÿ¢ŸÖÿØŸÖ.', 'ÿßŸà ÿ®Ÿá ÿÆÿßŸÜŸá ÿ±ŸÅÿ™.', 'ŸÖÿß ÿ®Ÿá ÿÆÿßŸÜŸá ÿ¢ŸÖÿØ€åŸÖ.'] },
            // Pr√§sens - haben und sein
            { type: 'mc', de: 'Ich bin Student. (Pr√§sens)', correct: 'ŸÖŸÜ ÿØÿßŸÜÿ¥ÿ¨Ÿà Ÿáÿ≥ÿ™ŸÖ.', options: ['ŸÖŸÜ ÿØÿßŸÜÿ¥ÿ¨Ÿà Ÿáÿ≥ÿ™ŸÖ.', 'ÿ™Ÿà ÿØÿßŸÜÿ¥ÿ¨Ÿà Ÿáÿ≥ÿ™€å.', 'ŸÖŸÜ ÿØÿßŸÜÿ¥ÿ¨Ÿà ÿ®ŸàÿØŸÖ.', 'ÿßŸà ÿØÿßŸÜÿ¥ÿ¨Ÿà ÿßÿ≥ÿ™.'] },
            { type: 'mc', de: 'Du bist mein Freund. (Pr√§sens)', correct: 'ÿ™Ÿà ÿØŸàÿ≥ÿ™ ŸÖŸÜ Ÿáÿ≥ÿ™€å.', options: ['ÿ™Ÿà ÿØŸàÿ≥ÿ™ ŸÖŸÜ Ÿáÿ≥ÿ™€å.', 'ŸÖŸÜ ÿØŸàÿ≥ÿ™ ÿ™Ÿà Ÿáÿ≥ÿ™ŸÖ.', 'ÿßŸà ÿØŸàÿ≥ÿ™ ŸÖŸÜ ÿßÿ≥ÿ™.', 'ÿ™Ÿà ÿØŸàÿ≥ÿ™ ŸÖŸÜ ÿ®ŸàÿØ€å.'] },
            { type: 'mc', de: 'Wir haben ein Haus. (Pr√§sens)', correct: 'ŸÖÿß €å⁄© ÿÆÿßŸÜŸá ÿØÿßÿ±€åŸÖ.', options: ['ŸÖÿß €å⁄© ÿÆÿßŸÜŸá ÿØÿßÿ±€åŸÖ.', 'ŸÖÿß €å⁄© ÿÆÿßŸÜŸá ÿØÿßÿ¥ÿ™€åŸÖ.', 'ÿ¥ŸÖÿß €å⁄© ÿÆÿßŸÜŸá ÿØÿßÿ±€åÿØ.', 'ÿ¢ŸÜŸáÿß €å⁄© ÿÆÿßŸÜŸá ÿØÿßÿ±ŸÜÿØ.'] },
            { type: 'mc', de: 'Er/Sie hat einen Bruder. (Pr√§sens)', correct: 'ÿßŸà €å⁄© ÿ®ÿ±ÿßÿØÿ± ÿØÿßÿ±ÿØ.', options: ['ÿßŸà €å⁄© ÿ®ÿ±ÿßÿØÿ± ÿØÿßÿ±ÿØ.', 'ÿßŸà €å⁄© ÿ®ÿ±ÿßÿØÿ± ÿØÿßÿ¥ÿ™.', 'ŸÖŸÜ €å⁄© ÿ®ÿ±ÿßÿØÿ± ÿØÿßÿ±ŸÖ.', 'ÿ™Ÿà €å⁄© ÿ®ÿ±ÿßÿØÿ± ÿØÿßÿ±€å.'] },
            // Word Bank - Original
            { type: 'wb', de: 'Ich a√ü Fr√ºhst√ºck.', words: ['ŸÖŸÜ', 'ÿµÿ®ÿ≠ÿßŸÜŸá', 'ÿÆŸàÿ±ÿØŸÖ'], extra: ['ÿ™Ÿà', 'ŸÜÿßŸáÿßÿ±'], alts: [['ÿµÿ®ÿ≠ÿßŸÜŸá', 'ŸÖŸÜ', 'ÿÆŸàÿ±ÿØŸÖ']] },
            { type: 'wb', de: 'Du sagtest Hallo.', words: ['ÿ™Ÿà', 'ÿ≥ŸÑÿßŸÖ', '⁄ØŸÅÿ™€å'], extra: ['ŸÖŸÜ', 'ÿÆÿØÿßÿ≠ÿßŸÅÿ∏'], alts: [['ÿ≥ŸÑÿßŸÖ', 'ÿ™Ÿà', '⁄ØŸÅÿ™€å'], ['ÿ™Ÿà', '⁄ØŸÅÿ™€å', 'ÿ≥ŸÑÿßŸÖ']] },
            { type: 'wb', de: 'Sie (er/sie) ging zur Bibliothek.', words: ['ÿßŸà', 'ÿ®Ÿá', '⁄©ÿ™ÿßÿ®ÿÆÿßŸÜŸá', 'ÿ±ŸÅÿ™'], extra: ['ŸÖŸÜ', 'ÿØÿßŸÜÿ¥⁄ØÿßŸá'] },
            { type: 'wb', de: 'Wir h√∂rten Musik.', words: ['ŸÖÿß', 'ŸÖŸàÿ≥€åŸÇ€å', 'ÿ¥ŸÜ€åÿØ€åŸÖ'], extra: ['ÿ¢ŸÜŸáÿß', 'ŸÅ€åŸÑŸÖ'], alts: [['ŸÖŸàÿ≥€åŸÇ€å', 'ŸÖÿß', 'ÿ¥ŸÜ€åÿØ€åŸÖ']] },
            { type: 'wb', de: 'Ihr kochtet Abendessen.', words: ['ÿ¥ŸÖÿß', 'ÿ¥ÿßŸÖ', 'ÿØÿ±ÿ≥ÿ™', '⁄©ÿ±ÿØ€åÿØ'], extra: ['ŸÜÿßŸáÿßÿ±', 'ŸÖÿß'] },
            { type: 'wb', de: 'Meine Mutter hatte zwei T√∂chter.', words: ['ŸÖÿßÿØÿ±', 'ŸÖŸÜ', 'ÿØŸà', 'ÿØÿÆÿ™ÿ±', 'ÿØÿßÿ¥ÿ™'], extra: ['ŸæÿØÿ±', 'ÿ≥Ÿá'] },
            { type: 'wb', de: 'Gestern kaufte ich Obst.', words: ['ÿØ€åÿ±Ÿàÿ≤', 'ŸÖŸÜ', 'ŸÖ€åŸàŸá', 'ÿÆÿ±€åÿØŸÖ'], extra: ['ÿßŸÖÿ±Ÿàÿ≤', 'ŸÜÿßŸÜ'], alts: [['ŸÖŸÜ', 'ÿØ€åÿ±Ÿàÿ≤', 'ŸÖ€åŸàŸá', 'ÿÆÿ±€åÿØŸÖ']] },
            { type: 'wb', de: 'Der Bruder schlief im Haus.', words: ['ÿ®ÿ±ÿßÿØÿ±', 'ÿØÿ±', 'ÿÆÿßŸÜŸá', 'ÿÆŸàÿßÿ®€åÿØ'], extra: ['ŸæÿØÿ±', 'ÿØÿßŸÜÿ¥⁄ØÿßŸá'] },
            // Word Bank - Verdoppelt/Neu
            { type: 'wb', de: 'Ich trank Tee.', words: ['ŸÖŸÜ', '⁄Üÿß€å', 'ŸÜŸàÿ¥€åÿØŸÖ'], extra: ['ÿ™Ÿà', 'ŸÇŸáŸàŸá'], alts: [['⁄Üÿß€å', 'ŸÖŸÜ', 'ŸÜŸàÿ¥€åÿØŸÖ']] },
            { type: 'wb', de: 'Du kauftest Brot.', words: ['ÿ™Ÿà', 'ŸÜÿßŸÜ', 'ÿÆÿ±€åÿØ€å'], extra: ['ŸÖŸÜ', 'ŸÖ€åŸàŸá'] },
            { type: 'wb', de: 'Wir gingen zur Schule.', words: ['ŸÖÿß', 'ÿ®Ÿá', 'ŸÖÿØÿ±ÿ≥Ÿá', 'ÿ±ŸÅÿ™€åŸÖ'], extra: ['ÿ¢ŸÜŸáÿß', 'ÿØÿßŸÜÿ¥⁄ØÿßŸá'] },
            { type: 'wb', de: 'Mein Vater las ein Buch.', words: ['ŸæÿØÿ±', 'ŸÖŸÜ', '€å⁄©', '⁄©ÿ™ÿßÿ®', 'ÿÆŸàÿßŸÜÿØ'], extra: ['ŸÖÿßÿØÿ±', 'ŸÅ€åŸÑŸÖ'] },
            { type: 'wb', de: 'Gestern war ich zuhause.', words: ['ÿØ€åÿ±Ÿàÿ≤', 'ŸÖŸÜ', 'ÿØÿ±', 'ÿÆÿßŸÜŸá', 'ÿ®ŸàÿØŸÖ'], extra: ['ÿßŸÖÿ±Ÿàÿ≤', 'ÿØÿßŸÜÿ¥⁄ØÿßŸá'], alts: [['ŸÖŸÜ', 'ÿØ€åÿ±Ÿàÿ≤', 'ÿØÿ±', 'ÿÆÿßŸÜŸá', 'ÿ®ŸàÿØŸÖ']] },
            { type: 'wb', de: 'Die Kinder a√üen Reis.', words: ['ÿ®⁄ÜŸá‚ÄåŸáÿß', 'ÿ®ÿ±ŸÜÿ¨', 'ÿÆŸàÿ±ÿØŸÜÿØ'], extra: ['ŸÜÿßŸÜ', 'ŸÖ€åŸàŸá'] }
        ];

        function initExercise2() {
            exerciseState = {
                questions: shuffleArray([...exercise2Questions]),
                currentIndex: 0,
                completed: 0,
                total: exercise2Questions.length,
                selectedWords: []
            };
            updateE2Progress();
            showE2Question();
        }

        function updateE2Progress() {
            const state = exerciseState;
            const pct = (state.completed / state.total) * 100;
            document.getElementById('e2-progress').style.width = pct + '%';
            document.getElementById('e2-current').textContent = state.completed;
            document.getElementById('e2-total').textContent = state.total;
        }

        function showE2Question() {
            const state = exerciseState;
            if (state.currentIndex >= state.questions.length) {
                showCertificate(2);
                return;
            }
            
            const q = state.questions[state.currentIndex];
            const area = document.getElementById('e2-question-area');
            
            if (q.type === 'mc') {
                const shuffledOptions = shuffleArray([...q.options]);
                area.innerHTML = `
                    <div class="question-box">
                        <p class="question-text">${q.de}</p>
                        <div class="options-container">
                            ${shuffledOptions.map(opt => 
                                `<button class="option-btn persian" onclick="checkMC(this, '${escapeHtml(opt)}', '${escapeHtml(q.correct)}')">${opt}</button>`
                            ).join('')}
                        </div>
                    </div>
                `;
            } else {
                // Word Bank
                state.selectedWords = [];
                const allWords = shuffleArray([...q.words, ...q.extra]);
                area.innerHTML = `
                    <div class="question-box">
                        <p class="question-text">${q.de}</p>
                        <div class="answer-area" id="wb-answer"></div>
                        <div class="word-bank" id="wb-bank">
                            ${allWords.map(w => 
                                `<span class="word-chip persian" onclick="toggleWord(this, '${escapeHtml(w)}')">${w}</span>`
                            ).join('')}
                        </div>
                        <button class="check-btn" style="width: 100%; margin-top: 15px;" onclick="checkWordBank()">√úberpr√ºfen</button>
                        <div id="wb-feedback"></div>
                    </div>
                `;
            }
        }

        function escapeHtml(text) {
            return text.replace(/'/g, "\\'").replace(/"/g, '\\"');
        }

        function checkMC(btn, selected, correct) {
            const buttons = btn.parentElement.querySelectorAll('.option-btn');
            
            if (selected === correct) {
                btn.classList.add('correct');
                exerciseState.completed++;
                updateE2Progress();
                setTimeout(() => {
                    exerciseState.currentIndex++;
                    showE2Question();
                }, 800);
            } else {
                btn.classList.add('wrong');
                // Zeige richtige Antwort
                buttons.forEach(b => {
                    if (b.textContent === correct) b.classList.add('correct');
                });
                // Zur√ºck in Stapel
                setTimeout(() => {
                    exerciseState.questions.push(exerciseState.questions[exerciseState.currentIndex]);
                    exerciseState.currentIndex++;
                    showE2Question();
                }, 1500);
            }
        }

        function toggleWord(chip, word) {
            const state = exerciseState;
            const idx = state.selectedWords.indexOf(word);
            
            if (idx === -1) {
                state.selectedWords.push(word);
                chip.classList.add('selected');
            } else {
                state.selectedWords.splice(idx, 1);
                chip.classList.remove('selected');
            }
            
            updateAnswerArea();
        }

        function updateAnswerArea() {
            const area = document.getElementById('wb-answer');
            area.innerHTML = exerciseState.selectedWords.map(w => 
                `<span class="answer-chip persian" onclick="removeWord('${escapeHtml(w)}')">${w}</span>`
            ).join('');
        }

        function removeWord(word) {
            const state = exerciseState;
            const idx = state.selectedWords.indexOf(word);
            if (idx !== -1) {
                state.selectedWords.splice(idx, 1);
                document.querySelectorAll('.word-chip').forEach(c => {
                    if (c.textContent === word) c.classList.remove('selected');
                });
                updateAnswerArea();
            }
        }

        function checkWordBank() {
            const state = exerciseState;
            const q = state.questions[state.currentIndex];
            const feedback = document.getElementById('wb-feedback');
            
            // Pr√ºfe Hauptantwort und Alternativen
            const selectedStr = JSON.stringify(state.selectedWords);
            let isCorrect = selectedStr === JSON.stringify(q.words);
            
            if (!isCorrect && q.alts) {
                for (const alt of q.alts) {
                    if (selectedStr === JSON.stringify(alt)) {
                        isCorrect = true;
                        break;
                    }
                }
            }
            
            if (isCorrect) {
                feedback.innerHTML = '<div class="feedback correct">‚úì Richtig!</div>';
                state.completed++;
                updateE2Progress();
                setTimeout(() => {
                    state.currentIndex++;
                    showE2Question();
                }, 800);
            } else {
                feedback.innerHTML = `<div class="feedback wrong">‚úó Richtige Antwort:<br><div class="persian" style="direction: rtl; text-align: right;">${q.words.join(' ')}</div></div>`;
                // Zur√ºck in Stapel
                setTimeout(() => {
                    state.questions.push(q);
                    state.currentIndex++;
                    showE2Question();
                }, 2000);
            }
        }

        // ===================== √úBUNG 3: VERB-KONJUGATION (NEU) =====================
        function generateConjugationQuestions() {
            const questions = [];
            const pronouns = ["ŸÖŸÜ", "ÿ™Ÿà", "ÿßŸà", "ŸÖÿß", "ÿ¥ŸÖÿß", "ÿ¢ŸÜŸáÿß"];
            const tenses = ['preterite', 'present'];
            
            // Pr√§teritum f√ºr alle Verben
            for (const verb of verbs) {
                for (const pronoun of pronouns) {
                    const ending = endings[pronoun];
                    const correct = verb.stamm + ending.end;
                    const correctUm = verb.stammUm + ending.endUm;
                    
                    // Generiere falsche Optionen
                    const wrongOptions = [];
                    for (const otherPronoun of pronouns) {
                        if (otherPronoun !== pronoun) {
                            const wrongEnding = endings[otherPronoun];
                            wrongOptions.push(verb.stamm + wrongEnding.end);
                        }
                    }
                    shuffleArray(wrongOptions);
                    
                    questions.push({
                        de: `${pronounsDE[pronoun]} - ${verb.de} (Pr√§teritum)`,
                        fa: pronoun,
                        verb: verb.inf,
                        correct: correct,
                        correctUm: correctUm,
                        options: shuffleArray([correct, ...wrongOptions.slice(0, 3)])
                    });
                }
            }
            
            // Pr√§sens f√ºr haben und sein
            for (const [verbKey, forms] of Object.entries(presentForms)) {
                const verbName = verbKey === 'budan' ? 'sein' : 'haben';
                for (const pronoun of pronouns) {
                    const correct = forms[pronoun];
                    
                    // Generiere falsche Optionen
                    const wrongOptions = [];
                    for (const otherPronoun of pronouns) {
                        if (otherPronoun !== pronoun) {
                            wrongOptions.push(forms[otherPronoun]);
                        }
                    }
                    shuffleArray(wrongOptions);
                    
                    questions.push({
                        de: `${pronounsDE[pronoun]} - ${verbName} (Pr√§sens)`,
                        fa: pronoun,
                        verb: verbKey === 'budan' ? 'ÿ®ŸàÿØŸÜ' : 'ÿØÿßÿ¥ÿ™ŸÜ',
                        correct: correct,
                        options: shuffleArray([correct, ...wrongOptions.slice(0, 3)])
                    });
                }
            }
            
            return shuffleArray(questions);
        }

        function initExercise3() {
            const allQuestions = generateConjugationQuestions();
            exerciseState = {
                questions: allQuestions.slice(0, 30),
                currentIndex: 0,
                completed: 0
            };
            updateE3Progress();
            showE3Question();
        }

        function updateE3Progress() {
            const state = exerciseState;
            const pct = (state.completed / 30) * 100;
            document.getElementById('e3-progress').style.width = pct + '%';
            document.getElementById('e3-current').textContent = state.completed;
        }

        function showE3Question() {
            const state = exerciseState;
            if (state.completed >= 30) {
                showCertificate(3);
                return;
            }
            
            const q = state.questions[state.currentIndex % state.questions.length];
            const area = document.getElementById('e3-question-area');
            
            area.innerHTML = `
                <div class="question-box">
                    <p class="question-text">${q.de}</p>
                    <p class="persian" style="font-size: 1.3em; margin-bottom: 15px;">${q.fa} + ${q.verb} = ?</p>
                    <div class="options-container">
                        ${q.options.map(opt => 
                            `<button class="option-btn persian" onclick="checkE3MC(this, '${escapeHtml(opt)}', '${escapeHtml(q.correct)}')">${opt}</button>`
                        ).join('')}
                    </div>
                </div>
            `;
        }

        function checkE3MC(btn, selected, correct) {
            const buttons = btn.parentElement.querySelectorAll('.option-btn');
            const state = exerciseState;
            
            if (selected === correct) {
                btn.classList.add('correct');
                state.completed++;
                state.currentIndex++;
                updateE3Progress();
                setTimeout(() => {
                    showE3Question();
                }, 600);
            } else {
                btn.classList.add('wrong');
                buttons.forEach(b => {
                    if (b.textContent === correct) b.classList.add('correct');
                });
                // Zur√ºck in Stapel
                setTimeout(() => {
                    state.questions.push(state.questions[state.currentIndex]);
                    state.currentIndex++;
                    showE3Question();
                }, 1200);
            }
        }

        // ===================== √úBUNG 4: PR√ÑTERITUM EINGABE =====================
        const exercise4Sentences = [
            // Positive S√§tze
            { de: "Ich ging zur Universit√§t.", fa: "ŸÖŸÜ ÿ®Ÿá ÿØÿßŸÜÿ¥⁄ØÿßŸá ÿ±ŸÅÿ™ŸÖ.", um: "man be dƒÅne≈°gƒÅh raftam", verb: "raftan", neg: false, alts: ["ŸÖŸÜ ÿ®Ÿá ÿØÿßŸÜÿ¥⁄ØÿßŸá ÿ±ŸÅÿ™ŸÖ"] },
            { de: "Du a√üt Brot.", fa: "ÿ™Ÿà ŸÜÿßŸÜ ÿÆŸàÿ±ÿØ€å.", um: "to nƒÅn ·∏´ordƒ´", verb: "·∏´ordan", neg: false, alts: ["ÿ™Ÿà ŸÜÿßŸÜ ÿÆŸàÿ±ÿØ€å"] },
            { de: "Er/Sie las ein Buch.", fa: "ÿßŸà €å⁄© ⁄©ÿ™ÿßÿ® ÿÆŸàÿßŸÜÿØ.", um: "u yek ketƒÅb ·∏´ƒÅnd", verb: "·∏´ƒÅndan", neg: false, alts: ["ÿßŸà €å⁄© ⁄©ÿ™ÿßÿ® ÿÆŸàÿßŸÜÿØ"] },
            { de: "Wir tranken Kaffee.", fa: "ŸÖÿß ŸÇŸáŸàŸá ŸÜŸàÿ¥€åÿØ€åŸÖ.", um: "mƒÅ qahve nu≈°ƒ´dƒ´m", verb: "nu≈°ƒ´dan", neg: false, alts: ["ŸÖÿß ŸÇŸáŸàŸá ŸÜŸàÿ¥€åÿØ€åŸÖ"] },
            { de: "Ihr hattet einen Freund.", fa: "ÿ¥ŸÖÿß €å⁄© ÿØŸàÿ≥ÿ™ ÿØÿßÿ¥ÿ™€åÿØ.", um: "≈°omƒÅ yek dust dƒÅ≈°tƒ´d", verb: "dƒÅ≈°tan", neg: false, alts: ["ÿ¥ŸÖÿß €å⁄© ÿØŸàÿ≥ÿ™ ÿØÿßÿ¥ÿ™€åÿØ"] },
            { de: "Sie (Pl.) sagten Hallo.", fa: "ÿ¢ŸÜŸáÿß ÿ≥ŸÑÿßŸÖ ⁄ØŸÅÿ™ŸÜÿØ.", um: "ƒÅnhƒÅ salƒÅm goftand", verb: "goftan", neg: false, alts: ["ÿ¢ŸÜŸáÿß ÿ≥ŸÑÿßŸÖ ⁄ØŸÅÿ™ŸÜÿØ"] },
            { de: "Ich h√∂rte Musik.", fa: "ŸÖŸÜ ŸÖŸàÿ≥€åŸÇ€å ÿ¥ŸÜ€åÿØŸÖ.", um: "man m≈´sƒ´qƒ´ ≈°enƒ´dam", verb: "≈°enƒ´dan", neg: false, alts: ["ŸÖŸÜ ŸÖŸàÿ≥€åŸÇ€å ÿ¥ŸÜ€åÿØŸÖ", "ŸÖŸàÿ≥€åŸÇ€å ŸÖŸÜ ÿ¥ŸÜ€åÿØŸÖ"] },
            { de: "Mein Vater kaufte Obst.", fa: "ŸæÿØÿ± ŸÖŸÜ ŸÖ€åŸàŸá ÿÆÿ±€åÿØ.", um: "pedar-e man mƒ´ve ·∏´arƒ´d", verb: "·∏´arƒ´dan", neg: false, alts: ["ŸæÿØÿ± ŸÖŸÜ ŸÖ€åŸàŸá ÿÆÿ±€åÿØ"] },
            { de: "Meine Mutter kochte das Abendessen.", fa: "ŸÖÿßÿØÿ± ŸÖŸÜ ÿ¥ÿßŸÖ ÿØÿ±ÿ≥ÿ™ ⁄©ÿ±ÿØ.", um: "mƒÅdar-e man ≈°ƒÅm dorost kard", verb: "dorost kardan", neg: false, alts: ["ŸÖÿßÿØÿ± ŸÖŸÜ ÿ¥ÿßŸÖ ÿØÿ±ÿ≥ÿ™ ⁄©ÿ±ÿØ"] },
            { de: "Das Kind schlief.", fa: "ÿ®⁄ÜŸá ÿÆŸàÿßÿ®€åÿØ.", um: "baƒçƒçe ·∏´ƒÅbƒ´d", verb: "·∏´ƒÅbƒ´dan", neg: false, alts: ["ÿ®⁄ÜŸá ÿÆŸàÿßÿ®€åÿØ"] },
            { de: "Wir kehrten nach Hause zur√ºck.", fa: "ŸÖÿß ÿ®Ÿá ÿÆÿßŸÜŸá ÿ®ÿ±⁄Øÿ¥ÿ™€åŸÖ.", um: "mƒÅ be ·∏´ƒÅne barga≈°tƒ´m", verb: "barga≈°tan", neg: false, alts: ["ŸÖÿß ÿ®Ÿá ÿÆÿßŸÜŸá ÿ®ÿ±⁄Øÿ¥ÿ™€åŸÖ"] },
            { de: "Ich wachte um 6 Uhr auf.", fa: "ŸÖŸÜ ÿ≥ÿßÿπÿ™ ÿ¥ÿ¥ ÿ®€åÿØÿßÿ± ÿ¥ÿØŸÖ.", um: "man sƒÅ øat-e ≈°e≈° bidƒÅr ≈°odam", verb: "bidƒÅr ≈°odan", neg: false, alts: ["ŸÖŸÜ ÿ≥ÿßÿπÿ™ ÿ¥ÿ¥ ÿ®€åÿØÿßÿ± ÿ¥ÿØŸÖ"] },
            { de: "Du h√∂rtest dem Lehrer zu.", fa: "ÿ™Ÿà ÿ®Ÿá ŸÖÿπŸÑŸÖ ⁄ØŸàÿ¥ ÿØÿßÿØ€å.", um: "to be mo øallem gu≈° dƒÅdƒ´", verb: "gu≈° dƒÅdan", neg: false, extra: { "ŸÖÿπŸÑŸÖ": "Lehrer" }, alts: ["ÿ™Ÿà ÿ®Ÿá ŸÖÿπŸÑŸÖ ⁄ØŸàÿ¥ ÿØÿßÿØ€å"] },
            { de: "Gestern war ich zuhause.", fa: "ÿØ€åÿ±Ÿàÿ≤ ŸÖŸÜ ÿØÿ± ÿÆÿßŸÜŸá ÿ®ŸàÿØŸÖ.", um: "dƒ´r≈´z man dar ·∏´ƒÅne budam", verb: "budan", neg: false, alts: ["ÿØ€åÿ±Ÿàÿ≤ ŸÖŸÜ ÿØÿ± ÿÆÿßŸÜŸá ÿ®ŸàÿØŸÖ", "ŸÖŸÜ ÿØ€åÿ±Ÿàÿ≤ ÿØÿ± ÿÆÿßŸÜŸá ÿ®ŸàÿØŸÖ"] },
            { de: "Der Bruder ging zum Unterricht.", fa: "ÿ®ÿ±ÿßÿØÿ± ÿ®Ÿá ⁄©ŸÑÿßÿ≥ ÿ±ŸÅÿ™.", um: "barƒÅdar be kelƒÅs raft", verb: "raftan", neg: false, alts: ["ÿ®ÿ±ÿßÿØÿ± ÿ®Ÿá ⁄©ŸÑÿßÿ≥ ÿ±ŸÅÿ™"] },
            // Verneinte S√§tze
            { de: "Ich ging nicht zur Universit√§t. (Verneinung)", fa: "ŸÖŸÜ ÿ®Ÿá ÿØÿßŸÜÿ¥⁄ØÿßŸá ŸÜÿ±ŸÅÿ™ŸÖ.", um: "man be dƒÅne≈°gƒÅh naraftam", verb: "raftan", neg: true, alts: ["ŸÖŸÜ ÿ®Ÿá ÿØÿßŸÜÿ¥⁄ØÿßŸá ŸÜÿ±ŸÅÿ™ŸÖ"] },
            { de: "Du a√üt kein Brot. (Verneinung)", fa: "ÿ™Ÿà ŸÜÿßŸÜ ŸÜÿÆŸàÿ±ÿØ€å.", um: "to nƒÅn na·∏´ordƒ´", verb: "·∏´ordan", neg: true, alts: ["ÿ™Ÿà ŸÜÿßŸÜ ŸÜÿÆŸàÿ±ÿØ€å"] },
            { de: "Er/Sie las nicht. (Verneinung)", fa: "ÿßŸà ŸÜÿÆŸàÿßŸÜÿØ.", um: "u na·∏´ƒÅnd", verb: "·∏´ƒÅndan", neg: true, alts: ["ÿßŸà ŸÜÿÆŸàÿßŸÜÿØ"] },
            { de: "Wir tranken keinen Kaffee. (Verneinung)", fa: "ŸÖÿß ŸÇŸáŸàŸá ŸÜŸÜŸàÿ¥€åÿØ€åŸÖ.", um: "mƒÅ qahve nanu≈°ƒ´dƒ´m", verb: "nu≈°ƒ´dan", neg: true, alts: ["ŸÖÿß ŸÇŸáŸàŸá ŸÜŸÜŸàÿ¥€åÿØ€åŸÖ"] },
            { de: "Sie hatten keinen Freund. (Verneinung)", fa: "ÿ¢ŸÜŸáÿß ÿØŸàÿ≥ÿ™ ŸÜÿØÿßÿ¥ÿ™ŸÜÿØ.", um: "ƒÅnhƒÅ dust nadƒÅ≈°tand", verb: "dƒÅ≈°tan", neg: true, alts: ["ÿ¢ŸÜŸáÿß ÿØŸàÿ≥ÿ™ ŸÜÿØÿßÿ¥ÿ™ŸÜÿØ"] },
            { de: "Ich h√∂rte keine Musik. (Verneinung)", fa: "ŸÖŸÜ ŸÖŸàÿ≥€åŸÇ€å ŸÜÿ¥ŸÜ€åÿØŸÖ.", um: "man m≈´sƒ´qƒ´ na≈°enƒ´dam", verb: "≈°enƒ´dan", neg: true, alts: ["ŸÖŸÜ ŸÖŸàÿ≥€åŸÇ€å ŸÜÿ¥ŸÜ€åÿØŸÖ"] },
            { de: "Das Kind schlief nicht. (Verneinung)", fa: "ÿ®⁄ÜŸá ŸÜÿÆŸàÿßÿ®€åÿØ.", um: "baƒçƒçe na·∏´ƒÅbƒ´d", verb: "·∏´ƒÅbƒ´dan", neg: true, alts: ["ÿ®⁄ÜŸá ŸÜÿÆŸàÿßÿ®€åÿØ"] },
            { de: "Wir kehrten nicht zur√ºck. (Verneinung)", fa: "ŸÖÿß ÿ®ÿ±ŸÜ⁄Øÿ¥ÿ™€åŸÖ.", um: "mƒÅ barnaga≈°tƒ´m", verb: "barga≈°tan", neg: true, alts: ["ŸÖÿß ÿ®ÿ±ŸÜ⁄Øÿ¥ÿ™€åŸÖ"] },
            // Weitere positive
            { de: "Die Schwester trank Tee.", fa: "ÿÆŸàÿßŸáÿ± ⁄Üÿß€å ŸÜŸàÿ¥€åÿØ.", um: "·∏´ƒÅhar ƒçƒÅy nu≈°ƒ´d", verb: "nu≈°ƒ´dan", neg: false, extra: { "⁄Üÿß€å": "Tee" }, alts: ["ÿÆŸàÿßŸáÿ± ⁄Üÿß€å ŸÜŸàÿ¥€åÿØ"] },
            { de: "Der Gro√üvater hatte 5 Kinder.", fa: "ŸæÿØÿ±ÿ®ÿ≤ÿ±⁄Ø ŸæŸÜÿ¨ ÿ®⁄ÜŸá ÿØÿßÿ¥ÿ™.", um: "pedar-bozorg panj baƒçƒçe dƒÅ≈°t", verb: "dƒÅ≈°tan", neg: false, alts: ["ŸæÿØÿ±ÿ®ÿ≤ÿ±⁄Ø ŸæŸÜÿ¨ ÿ®⁄ÜŸá ÿØÿßÿ¥ÿ™"] },
            { de: "Ich kaufte einen Film.", fa: "ŸÖŸÜ €å⁄© ŸÅ€åŸÑŸÖ ÿÆÿ±€åÿØŸÖ.", um: "man yek fƒ´lm ·∏´arƒ´dam", verb: "·∏´arƒ´dan", neg: false, alts: ["ŸÖŸÜ €å⁄© ŸÅ€åŸÑŸÖ ÿÆÿ±€åÿØŸÖ"] },
            { de: "Du wachtest um 7 Uhr auf.", fa: "ÿ™Ÿà ÿ≥ÿßÿπÿ™ ŸáŸÅÿ™ ÿ®€åÿØÿßÿ± ÿ¥ÿØ€å.", um: "to sƒÅ øat-e haft bidƒÅr ≈°odƒ´", verb: "bidƒÅr ≈°odan", neg: false, alts: ["ÿ™Ÿà ÿ≥ÿßÿπÿ™ ŸáŸÅÿ™ ÿ®€åÿØÿßÿ± ÿ¥ÿØ€å"] },
            { de: "Die Studentin ging zur Bibliothek.", fa: "ÿØÿßŸÜÿ¥ÿ¨Ÿà ÿ®Ÿá ⁄©ÿ™ÿßÿ®ÿÆÿßŸÜŸá ÿ±ŸÅÿ™.", um: "dƒÅne≈°«ß≈´ be ketƒÅb·∏´ƒÅne raft", verb: "raftan", neg: false, alts: ["ÿØÿßŸÜÿ¥ÿ¨Ÿà ÿ®Ÿá ⁄©ÿ™ÿßÿ®ÿÆÿßŸÜŸá ÿ±ŸÅÿ™"] },
            { de: "Wir a√üen Mittagessen.", fa: "ŸÖÿß ŸÜÿßŸáÿßÿ± ÿÆŸàÿ±ÿØ€åŸÖ.", um: "mƒÅ nƒÅhƒÅr ·∏´ordƒ´m", verb: "·∏´ordan", neg: false, alts: ["ŸÖÿß ŸÜÿßŸáÿßÿ± ÿÆŸàÿ±ÿØ€åŸÖ"] },
            { de: "Die Eltern sagten nichts. (Verneinung)", fa: "ŸæÿØÿ± Ÿà ŸÖÿßÿØÿ± ⁄Ü€åÿ≤€å ŸÜ⁄ØŸÅÿ™ŸÜÿØ.", um: "pedar-o mƒÅdar ƒçƒ´zƒ´ nagoftand", verb: "goftan", neg: true, extra: { "⁄Ü€åÿ≤€å": "etwas/nichts" }, alts: ["ŸæÿØÿ± Ÿà ŸÖÿßÿØÿ± ⁄Ü€åÿ≤€å ŸÜ⁄ØŸÅÿ™ŸÜÿØ"] }
        ];

        function initExercise4() {
            exerciseState = {
                sentences: shuffleArray([...exercise4Sentences]),
                currentIndex: 0,
                completed: 0
            };
            updateE4Progress();
            showE4Sentence();
        }

        function updateE4Progress() {
            const state = exerciseState;
            const pct = (state.completed / 30) * 100;
            document.getElementById('e4-progress').style.width = pct + '%';
            document.getElementById('e4-current').textContent = state.completed;
        }

        function showE4Sentence() {
            const state = exerciseState;
            if (state.completed >= 30) {
                showCertificate(4);
                return;
            }
            
            const s = state.sentences[state.currentIndex % state.sentences.length];
            const area = document.getElementById('e4-sentence-area');
            
            // Extra Vokabeln als Tooltips
            let extraHtml = '';
            if (s.extra) {
                extraHtml = '<p style="margin-top: 10px; font-size: 0.85em; color: #ffa502;">üí° Neue W√∂rter: ';
                for (const [fa, de] of Object.entries(s.extra)) {
                    extraHtml += `<span class="tooltip-word persian" data-meaning="${de}">${fa}</span> `;
                }
                extraHtml += '</p>';
            }
            
            // Verb-Info
            const verbInfo = verbs.find(v => v.um === s.verb);
            const verbDisplay = verbInfo ? `(${verbInfo.inf} - ${verbInfo.de})` : '';
            
            area.innerHTML = `
                <div class="sentence-card">
                    <p class="sentence-german">${s.de}</p>
                    <p class="sentence-hint">Verb: ${verbDisplay} ${s.neg ? 'üö´ Verneinung mit ŸÜŸÄ' : ''}</p>
                    ${extraHtml}
                    <div class="input-area">
                        <input type="text" class="persian-input" id="e4-input" placeholder="Persische √úbersetzung..." autocomplete="off">
                        <button class="check-btn" onclick="checkE4Answer()">‚úì</button>
                    </div>
                    <div id="e4-feedback"></div>
                    <p style="margin-top: 15px; font-size: 0.8em; opacity: 0.6;">Umschrift: ${s.um}</p>
                </div>
            `;
            
            document.getElementById('e4-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') checkE4Answer();
            });
            document.getElementById('e4-input').focus();
        }

        function checkE4Answer() {
            const state = exerciseState;
            const s = state.sentences[state.currentIndex % state.sentences.length];
            const input = document.getElementById('e4-input').value.trim();
            const feedback = document.getElementById('e4-feedback');
            
            // Normalisiere f√ºr Vergleich (entferne Punkte)
            const normalizeLight = str => str.replace(/[.€îŸ™ÿå,]/g, '').trim();
            
            // Strenge Normalisierung (entferne alle Leerzeichen und Halbleerzeichen)
            const normalizeStrict = str => str.replace(/[\s\u200C\u200B\u00A0]+/g, '').replace(/[.€îŸ™ÿå,]/g, '').trim();
            
            const inputLight = normalizeLight(input);
            const correctLight = normalizeLight(s.fa);
            const inputStrict = normalizeStrict(input);
            const correctStrict = normalizeStrict(s.fa);
            
            // Pr√ºfe exakte √úbereinstimmung (ohne Punkt)
            let isExact = inputLight === correctLight;
            
            // Pr√ºfe auch Alternativen
            if (!isExact && s.alts) {
                for (const alt of s.alts) {
                    if (inputLight === normalizeLight(alt)) {
                        isExact = true;
                        break;
                    }
                }
            }
            
            // Pr√ºfe Leerzeichen-tolerante √úbereinstimmung
            let isAlmostCorrect = false;
            if (!isExact) {
                isAlmostCorrect = inputStrict === correctStrict;
                
                if (!isAlmostCorrect && s.alts) {
                    for (const alt of s.alts) {
                        if (inputStrict === normalizeStrict(alt)) {
                            isAlmostCorrect = true;
                            break;
                        }
                    }
                }
            }
            
            if (isExact) {
                feedback.innerHTML = '<div class="feedback correct">‚úì Richtig! Sehr gut!</div>';
                state.completed++;
                state.currentIndex++;
                updateE4Progress();
                setTimeout(() => {
                    showE4Sentence();
                }, 800);
            } else if (isAlmostCorrect) {
                // Fast richtig - Leerzeichen-Problem
                feedback.innerHTML = `
                    <div class="feedback" style="background: rgba(255, 165, 2, 0.3); border: 1px solid #ffa502;">
                        ‚ö†Ô∏è Fast richtig! Achte auf Leerzeichen:<br>
                        <div class="persian" style="font-size: 1.3em; direction: rtl; text-align: right;">${s.fa}</div>
                    </div>
                `;
                state.completed++;
                state.currentIndex++;
                updateE4Progress();
                setTimeout(() => {
                    showE4Sentence();
                }, 2500);
            } else {
                feedback.innerHTML = `
                    <div class="feedback wrong">
                        ‚úó Richtige Antwort:<br>
                        <div class="persian" style="font-size: 1.3em; direction: rtl; text-align: right;">${s.fa}</div>
                    </div>
                `;
                // Zur√ºck in Stapel
                setTimeout(() => {
                    state.sentences.push(s);
                    state.currentIndex++;
                    showE4Sentence();
                }, 4000);
            }
        }

        // ===================== ZERTIFIKAT =====================
        let currentCertificateExercise = 0;
        
        function showCertificate(exerciseNum) {
            currentCertificateExercise = exerciseNum;
            showScreen('certificate-screen');
            
            // Zeige Namenseingabe, verstecke Canvas und Download
            document.getElementById('name-input-area').style.display = 'block';
            document.getElementById('certificate-canvas').style.display = 'none';
            document.getElementById('download-area').style.display = 'none';
            document.getElementById('certificate-name').value = '';
            document.getElementById('certificate-name').focus();
        }
        
        function generateCertificateWithName() {
            const name = document.getElementById('certificate-name').value.trim() || 'Teilnehmer/in';
            const exerciseNum = currentCertificateExercise;
            
            const canvas = document.getElementById('certificate-canvas');
            const ctx = canvas.getContext('2d');
            
            // Hintergrund
            const gradient = ctx.createLinearGradient(0, 0, 600, 400);
            gradient.addColorStop(0, '#1a1a2e');
            gradient.addColorStop(0.5, '#16213e');
            gradient.addColorStop(1, '#0f3460');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 600, 400);
            
            // Rahmen
            ctx.strokeStyle = '#4ecdc4';
            ctx.lineWidth = 8;
            ctx.strokeRect(20, 20, 560, 360);
            
            ctx.strokeStyle = '#ffa502';
            ctx.lineWidth = 3;
            ctx.strokeRect(35, 35, 530, 330);
            
            // Titel
            ctx.fillStyle = '#4ecdc4';
            ctx.font = 'bold 28px Segoe UI';
            ctx.textAlign = 'center';
            ctx.fillText('üéì ZERTIFIKAT', 300, 70);
            
            // Untertitel
            ctx.fillStyle = '#ffffff';
            ctx.font = '16px Segoe UI';
            ctx.fillText('√úbungscamp Pr√§teritum - Persisch', 300, 100);
            
            // Name
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 22px Segoe UI';
            ctx.fillText(name, 300, 145);
            
            // √úbung
            const exerciseNames = ['', 'Vokabel-Matching', 'S√§tze verstehen', 'Verb-Konjugation', 'Pr√§teritum schreiben'];
            ctx.fillStyle = '#ffa502';
            ctx.font = 'bold 20px Segoe UI';
            ctx.fillText(`√úbung ${exerciseNum}: ${exerciseNames[exerciseNum]}`, 300, 190);
            
            // Erfolg
            ctx.fillStyle = '#2ecc71';
            ctx.font = '18px Segoe UI';
            ctx.fillText('‚úì Erfolgreich abgeschlossen!', 300, 230);
            
            // Datum
            const now = new Date();
            const dateStr = now.toLocaleDateString('de-DE', { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            ctx.fillStyle = '#ffffff';
            ctx.font = '14px Segoe UI';
            ctx.fillText(`Datum: ${dateStr}`, 300, 280);
            
            // Code
            const code = generateCode(exerciseNum);
            ctx.fillStyle = '#e94560';
            ctx.font = 'bold 18px monospace';
            ctx.fillText(`Code: ${code}`, 300, 320);
            
            // Footer
            ctx.fillStyle = 'rgba(255,255,255,0.5)';
            ctx.font = '12px Segoe UI';
            ctx.fillText('JIK-AWO 25/26 - Persisch Kurs', 300, 370);
            
            // Zeige Canvas und Download, verstecke Eingabe
            document.getElementById('name-input-area').style.display = 'none';
            document.getElementById('certificate-canvas').style.display = 'block';
            document.getElementById('download-area').style.display = 'block';
            
            // Download-Link aktualisieren
            const downloadLink = document.getElementById('download-link');
            downloadLink.href = canvas.toDataURL('image/png');
            downloadLink.download = `${code}.png`;
        }

        function generateCode(exerciseNum) {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return `U${exerciseNum}-${code}`;
        }

        // ===================== HILFSFUNKTIONEN =====================
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
    </script>
</body>
</html>
