<!DOCTYPE html>
<html lang="de" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Was habe ich gestern gemacht - Ø¯ÛŒØ±ÙˆØ² Ú†Ù‡ Ú©Ø±Ø¯Ù…</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
        }

        .page {
            display: none;
            min-height: 100vh;
            animation: fadeIn 0.5s;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .persian-title {
            font-size: 1.8em;
            direction: rtl;
            font-weight: bold;
            margin-top: 10px;
        }

        .home-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s;
        }

        .home-btn:hover {
            background: white;
            color: #667eea;
            transform: scale(1.05);
        }

        /* Startseite */
        .welcome-section {
            padding: 60px 30px;
            text-align: center;
        }

        .welcome-title {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 20px;
        }

        .welcome-subtitle {
            font-size: 1.3em;
            color: #666;
            margin-bottom: 50px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            max-width: 900px;
            margin: 0 auto;
        }

        .menu-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .menu-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
        }

        .menu-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .menu-title {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .menu-description {
            font-size: 0.95em;
            opacity: 0.9;
        }

        /* Content Seiten */
        .content-page {
            padding: 40px 30px;
            min-height: calc(100vh - 140px);
        }

        .page-title {
            font-size: 2em;
            color: #667eea;
            margin-bottom: 30px;
            text-align: center;
        }

        .persian-text {
            direction: rtl;
            text-align: right;
            font-size: 1.4em;
            line-height: 2;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .persian-word {
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 5px;
            transition: background 0.2s;
        }

        .persian-word:hover {
            background: #ffd93d;
        }

        .tooltip {
            position: absolute;
            background: #333;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            z-index: 1000;
            max-width: 200px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            direction: ltr;
            text-align: left;
        }

        .question {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
        }

        .question-text {
            font-size: 1.2em;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .persian-question {
            direction: rtl;
            text-align: right;
        }

        .answer-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-yes, .btn-no {
            flex: 1;
            min-width: 120px;
        }

        .btn-yes {
            background: #4caf50;
            color: white;
        }

        .btn-yes:hover {
            background: #45a049;
        }

        .btn-no {
            background: #f44336;
            color: white;
        }

        .btn-no:hover {
            background: #da190b;
        }

        .btn-check {
            background: #ff9800;
            color: white;
            width: 100%;
            margin-top: 20px;
            padding: 15px;
            font-size: 1.1em;
        }

        .btn-check:hover {
            background: #e68900;
        }

        .btn-next {
            background: #2196F3;
            color: white;
            width: 100%;
            margin-top: 20px;
            padding: 15px;
            font-size: 1.1em;
        }

        .btn-next:hover {
            background: #0b7dda;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            margin-top: 10px;
            direction: rtl;
            text-align: right;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            display: none;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .score {
            text-align: center;
            font-size: 1.5em;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            margin: 20px 0;
        }

        .word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .word-chip {
            padding: 10px 20px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            direction: rtl;
        }

        .word-chip:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }

        .word-chip.selected {
            background: #667eea;
            color: white;
        }

        .sentence-builder {
            min-height: 60px;
            padding: 20px;
            background: white;
            border: 3px dashed #667eea;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            direction: rtl;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Flashcards */
        .flashcard-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 700px;
            margin: 0 auto;
        }

        .category-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .category-btn {
            padding: 12px 25px;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .category-btn:hover, .category-btn.active {
            background: #667eea;
            color: white;
        }

        .flashcard {
            perspective: 1000px;
            width: 100%;
            max-width: 500px;
            height: 350px;
            margin-bottom: 30px;
        }

        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }

        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .flashcard-front {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .flashcard-back {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            transform: rotateY(180deg);
        }

        .flashcard-text {
            font-size: 2.2em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
        }

        .flashcard-transcription {
            font-size: 1.2em;
            opacity: 0.9;
            font-style: italic;
            text-align: center;
        }

        .flashcard-hint {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 20px;
        }

        .flashcard-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 500px;
            gap: 20px;
        }

        .nav-arrow {
            padding: 15px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.3s;
        }

        .nav-arrow:hover {
            background: #5568d3;
            transform: scale(1.05);
        }

        .nav-arrow:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: scale(1);
        }

        .card-counter {
            font-size: 1.2em;
            font-weight: bold;
            color: white;
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 10px;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .radio-option {
            padding: 12px;
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .radio-option:hover {
            background: #e9ecef;
            border-color: #667eea;
        }

        .radio-option.selected {
            background: #e7f3ff;
            border-color: #667eea;
        }

        .radio-option input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .hint {
            color: #666;
            font-style: italic;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .back-to-home {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 30px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            transition: all 0.3s;
        }

        .back-to-home:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5em;
            }

            .persian-title {
                font-size: 1.3em;
            }

            .home-btn {
                position: static;
                margin-bottom: 15px;
            }

            .welcome-title {
                font-size: 1.8em;
            }

            .menu-grid {
                grid-template-columns: 1fr;
            }

            .flashcard {
                height: 300px;
            }

            .flashcard-text {
                font-size: 1.6em;
            }

            .nav-arrow {
                padding: 12px 20px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <!-- Startseite -->
    <div class="page active" id="page-home">
        <div class="container">
            <div class="header">
                <h1>Was habe ich gestern gemacht</h1>
                <div class="persian-title">Ø¯ÛŒØ±ÙˆØ² Ú†Ù‡ Ú©Ø±Ø¯Ù…</div>
            </div>
            <div class="welcome-section">
                <div class="welcome-title">Willkommen! ğŸ‘‹</div>
                <div class="welcome-subtitle">WÃ¤hle eine Ãœbung aus:</div>
                
                <div class="menu-grid">
                    <div class="menu-card" onclick="goToPage('text')">
                        <div class="menu-icon">ğŸ“–</div>
                        <div class="menu-title">Text lesen</div>
                        <div class="menu-description">Lese den persischen Text und beantworte Fragen</div>
                    </div>

                    <div class="menu-card" onclick="goToPage('sentence')">
                        <div class="menu-icon">ğŸ”¨</div>
                        <div class="menu-title">Satzbau</div>
                        <div class="menu-description">Baue persische SÃ¤tze im PrÃ¤teritum</div>
                    </div>

                    <div class="menu-card" onclick="goToPage('gap')">
                        <div class="menu-icon">ğŸ“</div>
                        <div class="menu-title">LÃ¼ckentext</div>
                        <div class="menu-description">Setze Verben im PrÃ¤teritum ein</div>
                    </div>

                    <div class="menu-card" onclick="goToPage('translation')">
                        <div class="menu-icon">ğŸ”„</div>
                        <div class="menu-title">Ãœbersetzung</div>
                        <div class="menu-description">Ãœbersetze SÃ¤tze ins Deutsche</div>
                    </div>

                    <div class="menu-card" onclick="goToPage('quiz')">
                        <div class="menu-icon">â“</div>
                        <div class="menu-title">Grammatik-Quiz</div>
                        <div class="menu-description">Verbkonjugation im PrÃ¤teritum</div>
                    </div>

                    <div class="menu-card" onclick="goToPage('flashcards')">
                        <div class="menu-icon">ğŸ—‚ï¸</div>
                        <div class="menu-title">Vokabelkarten</div>
                        <div class="menu-description">Lerne Vokabeln mit Flashcards</div>
                    </div>

                    <div class="menu-card" onclick="goToPage('vocabquiz')">
                        <div class="menu-icon">ğŸ¯</div>
                        <div class="menu-title">Vokabel-Quiz</div>
                        <div class="menu-description">Teste dein Vokabelwissen</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Seite 1: Text lesen -->
    <div class="page" id="page-text">
        <div class="container">
            <div class="header">
                <button class="home-btn" onclick="goToPage('home')">ğŸ  Home</button>
                <h1>Text lesen</h1>
            </div>
            <div class="content-page">
                <div class="persian-text" id="persianText"></div>
                
                <h3 style="margin-top: 30px; margin-bottom: 20px;">Richtig oder Falsch?</h3>
                <div id="truefalseQuestions"></div>

                <h3 style="margin-top: 30px; margin-bottom: 20px;">Fragen zum Text</h3>
                <div id="openQuestions"></div>

                <button class="btn btn-check" onclick="checkTextAnswers()">Antworten Ã¼berprÃ¼fen</button>
                <div class="score" id="textScore" style="display: none;"></div>
                
                <button class="back-to-home" onclick="goToPage('home')">ğŸ  ZurÃ¼ck zur Ãœbersicht</button>
            </div>
        </div>
    </div>

    <!-- Seite 2: Satzbau -->
    <div class="page" id="page-sentence">
        <div class="container">
            <div class="header">
                <button class="home-btn" onclick="goToPage('home')">ğŸ  Home</button>
                <h1>Satzbau</h1>
            </div>
            <div class="content-page">
                <div class="progress-bar">
                    <div class="progress-fill" id="sentenceProgress">0 / 20</div>
                </div>
                <div class="question">
                    <div class="question-text" id="sentenceTask"></div>
                    <div class="sentence-builder" id="sentenceBuilder"></div>
                    <div class="word-bank" id="wordBank"></div>
                    <div class="feedback" id="sentenceFeedback"></div>
                </div>
                <button class="btn btn-check" onclick="checkSentence()">Satz Ã¼berprÃ¼fen</button>
                <button class="btn btn-next" onclick="nextSentence()" style="display: none;" id="sentenceNext">NÃ¤chster Satz</button>
                <div class="score" id="sentenceScore" style="display: none;"></div>
                
                <button class="back-to-home" onclick="goToPage('home')">ğŸ  ZurÃ¼ck zur Ãœbersicht</button>
            </div>
        </div>
    </div>

    <!-- Seite 3: LÃ¼ckentext -->
    <div class="page" id="page-gap">
        <div class="container">
            <div class="header">
                <button class="home-btn" onclick="goToPage('home')">ğŸ  Home</button>
                <h1>LÃ¼ckentext</h1>
            </div>
            <div class="content-page">
                <div class="progress-bar">
                    <div class="progress-fill" id="gapProgress">0 / 20</div>
                </div>
                <div id="gapQuestions"></div>
                <button class="btn btn-check" onclick="checkGapText()">Alle Ã¼berprÃ¼fen</button>
                <div class="score" id="gapScore" style="display: none;"></div>
                
                <button class="back-to-home" onclick="goToPage('home')">ğŸ  ZurÃ¼ck zur Ãœbersicht</button>
            </div>
        </div>
    </div>

    <!-- Seite 4: Ãœbersetzung -->
    <div class="page" id="page-translation">
        <div class="container">
            <div class="header">
                <button class="home-btn" onclick="goToPage('home')">ğŸ  Home</button>
                <h1>Ãœbersetzung</h1>
            </div>
            <div class="content-page">
                <div class="progress-bar">
                    <div class="progress-fill" id="translationProgress">0 / 20</div>
                </div>
                <div id="translationQuestions"></div>
                <button class="btn btn-check" onclick="checkTranslations()">Alle Ã¼berprÃ¼fen</button>
                <div class="score" id="translationScore" style="display: none;"></div>
                
                <button class="back-to-home" onclick="goToPage('home')">ğŸ  ZurÃ¼ck zur Ãœbersicht</button>
            </div>
        </div>
    </div>

    <!-- Seite 5: Quiz -->
    <div class="page" id="page-quiz">
        <div class="container">
            <div class="header">
                <button class="home-btn" onclick="goToPage('home')">ğŸ  Home</button>
                <h1>Grammatik-Quiz</h1>
            </div>
            <div class="content-page">
                <div class="progress-bar">
                    <div class="progress-fill" id="quizProgress">0 / 20</div>
                </div>
                <div class="question" id="quizQuestion">
                    <div class="question-text" id="quizText"></div>
                    <div class="radio-group" id="quizOptions"></div>
                    <div class="feedback" id="quizFeedback"></div>
                </div>
                <button class="btn btn-check" onclick="checkQuiz()">Antwort Ã¼berprÃ¼fen</button>
                <button class="btn btn-next" onclick="nextQuiz()" style="display: none;" id="quizNext">NÃ¤chste Frage</button>
                <div class="score" id="quizScore" style="display: none;"></div>
                
                <button class="back-to-home" onclick="goToPage('home')">ğŸ  ZurÃ¼ck zur Ãœbersicht</button>
            </div>
        </div>
    </div>

    <!-- Seite 6: Flashcards -->
    <div class="page" id="page-flashcards">
        <div class="container">
            <div class="header">
                <button class="home-btn" onclick="goToPage('home')">ğŸ  Home</button>
                <h1>Vokabelkarten</h1>
            </div>
            <div class="content-page">
                <div class="flashcard-container">
                    <div class="category-selector" id="categorySelector"></div>
                    
                    <div class="flashcard" id="flashcard" onclick="flipCard()">
                        <div class="flashcard-inner">
                            <div class="flashcard-front">
                                <div class="flashcard-text" id="cardFront"></div>
                                <div class="flashcard-hint">ğŸ”„ Klicke zum Umdrehen</div>
                            </div>
                            <div class="flashcard-back">
                                <div class="flashcard-text" id="cardBack"></div>
                                <div class="flashcard-transcription" id="cardTranscription"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flashcard-navigation">
                        <button class="nav-arrow" onclick="previousCard()" id="prevBtn">â—„ ZurÃ¼ck</button>
                        <div class="card-counter" id="cardCounter">1 / 1</div>
                        <button class="nav-arrow" onclick="nextCard()" id="nextBtn">Weiter â–º</button>
                    </div>
                </div>
                
                <button class="back-to-home" onclick="goToPage('home')">ğŸ  ZurÃ¼ck zur Ãœbersicht</button>
            </div>
        </div>
    </div>

    <!-- Seite 7: Vokabel-Quiz -->
    <div class="page" id="page-vocabquiz">
        <div class="container">
            <div class="header">
                <button class="home-btn" onclick="goToPage('home')">ğŸ  Home</button>
                <h1>Vokabel-Quiz</h1>
            </div>
            <div class="content-page">
                <div class="progress-bar">
                    <div class="progress-fill" id="vocabQuizProgress">0 / 20</div>
                </div>
                <div class="question">
                    <div class="question-text" id="vocabQuizText"></div>
                    <div class="radio-group" id="vocabQuizOptions"></div>
                    <div class="feedback" id="vocabQuizFeedback"></div>
                </div>
                <button class="btn btn-check" onclick="checkVocabQuiz()">Antwort Ã¼berprÃ¼fen</button>
                <button class="btn btn-next" onclick="nextVocabQuiz()" style="display: none;" id="vocabQuizNext">NÃ¤chste Frage</button>
                <div class="score" id="vocabQuizScore" style="display: none;"></div>
                
                <button class="back-to-home" onclick="goToPage('home')">ğŸ  ZurÃ¼ck zur Ãœbersicht</button>
            </div>
        </div>
    </div>

    <script>
        // Navigation zwischen Seiten
        function goToPage(pageName) {
            // Verstecke alle Seiten
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Zeige gewÃ¤hlte Seite
            document.getElementById(`page-${pageName}`).classList.add('active');
            
            // Scroll nach oben
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Initialisiere Seite wenn nÃ¶tig
            if (pageName === 'sentence' && currentSentence === 0) {
                initSentenceBuilder();
            } else if (pageName === 'quiz' && currentQuiz === 0) {
                initQuiz();
            } else if (pageName === 'vocabquiz' && vocabQuizData.length === 0) {
                initVocabQuiz();
            } else if (pageName === 'flashcards') {
                initFlashcards();
            } else if (pageName === 'text') {
                initTextSection();
            } else if (pageName === 'gap') {
                initGapText();
            } else if (pageName === 'translation') {
                initTranslation();
            }
        }

        // Vokabular
        const vocabulary = {
            'Ø³ÙÙ„Ø§Ù…': 'Hallo',
            'Ù…Ù†': 'ich',
            'Ù…ÛŒÙ†Ø§': 'Mina (Name)',
            'Ù‡ÙØ³ØªÙÙ…': 'bin (1. Pers. Sg.)',
            'Ø¯Ø§Ù†ÙØ´Ø¬Ùˆ': 'Student/in',
            'Ø¯ÛŒØ±ÙˆØ²': 'gestern',
            'ØµÙØ¨Ø­': 'Morgen',
            'Ø³Ø§Ø¹ÙØªÙ': 'Uhrzeit',
            'Ø´ÙØ´': 'sechs',
            'Ø¨ÛŒØ¯Ø§Ø±': 'wach',
            'Ø´ÙØ¯ÙÙ…': 'wurde (1. Pers. Sg.)',
            'Ù‡ÙÙØª': 'sieben',
            'ØµÙØ¨Ø­Ø§Ù†ÙÙ‡': 'FrÃ¼hstÃ¼ck',
            'Ø®ÙÙˆØ±Ø¯ÙÙ…': 'aÃŸ (1. Pers. Sg.)',
            'Ø¨ÙØ¹Ø¯': 'dann, danach',
            'Ø¨Ø§': 'mit',
            'Ø§ÙØªÙˆØ¨ÙˆØ³': 'Bus',
            'Ø¨Ù‡': 'zu, nach',
            'Ø¯Ø§Ù†ÙØ´Ú¯Ø§Ù‡': 'UniversitÃ¤t',
            'Ø±ÙÙØªÙÙ…': 'ging (1. Pers. Sg.)',
            'Ø¯Ø±': 'in',
            'Ø§Ø²': 'von',
            'ØªØ§': 'bis',
            'Ù‡ÙØ´Øª': 'acht',
            'Ø¯ÙÙ‡': 'zehn',
            'ÛŒÚ©': 'ein',
            'Ú©ÙÙ„Ø§Ø³': 'Kurs, Unterricht',
            'Ø¯Ø§Ø´ØªÙÙ…': 'hatte (1. Pers. Sg.)',
            'Ø¯ÙˆØ³ØªÙÙ…': 'mein/e Freund/in',
            'Ù‚ÙÙ‡ÙˆÙ‡': 'Kaffee',
            'Ù†ÙˆØ´ÛŒØ¯ÙÙ…': 'trank (1. Pers. Sg.)',
            'Ø­ÙØ±Ù': 'GesprÃ¤ch',
            'Ø²ÙØ¯ÛŒÙ…': 'fÃ¼hrten (1. Pers. Pl.)',
            'Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡': 'Bibliothek',
            'Ø¯Ùˆ': 'zwei',
            'Ø¯ÙØ±Ø³': 'Lektion',
            'Ø®ÙˆØ§Ù†ÙØ¯Ù…': 'las, lernte (1. Pers. Sg.)',
            'Ø¸ÙÙ‡Ø±': 'Mittag',
            'Ø®Ø§Ù†Ù‡': 'Haus, nach Hause',
            'Ø¨Ø±ÙÚ¯ÙØ´ØªÙ…': 'kehrte zurÃ¼ck (1. Pers. Sg.)',
            'Ù†Ø§Ù‡Ø§Ø±': 'Mittagessen',
            'Ù…ÙˆØ³ÛŒÙ‚ÛŒ': 'Musik',
            'Ú¯ÙˆØ´': 'Ohr',
            'Ø¯Ø§Ø¯Ù…': 'gab (1. Pers. Sg.)',
            'Ø¹ÙØµØ±': 'Nachmittag',
            'Ø®Ø±ÛŒØ¯': 'Einkauf',
            'Ù…ÛŒÙˆÙÙ‡': 'Obst',
            'Ù†Ø§Ù†': 'Brot',
            'Ø®Ø±ÛŒØ¯Ù…': 'kaufte (1. Pers. Sg.)',
            'Ø´ÙØ¨': 'Abend',
            'Ø´Ø§Ù…': 'Abendessen',
            'Ø¯ÙØ±ÙØ³Øª': 'richtig',
            'Ú©ÙØ±Ø¯Ù…': 'machte (1. Pers. Sg.)',
            'Ù†ÙÙ‡': 'neun',
            'ÙÛŒÙ„Ù…': 'Film',
            'Ø¯ÛŒØ¯ÙÙ…': 'sah (1. Pers. Sg.)',
            'Ø®ÙˆØ§Ø¨ÛŒØ¯Ù…': 'schlief (1. Pers. Sg.)',
            'Ùˆ': 'und',
            'Ø³Ø§Ø¹ÙØª': 'Uhr',
            'ÛŒÙØ¹Ø¯': 'dann (Variante von Ø¨Ø¹Ø¯)'
        };

        const fullText = 'Ø³ÙÙ„Ø§Ù…! Ù…Ù† Ù…ÛŒÙ†Ø§ Ù‡ÙØ³ØªÙÙ…. Ù…Ù† Ø¯Ø§Ù†ÙØ´Ø¬Ùˆ Ù‡Ø³ØªÙ…. Ø¯ÛŒØ±ÙˆØ² ØµÙØ¨Ø­ Ø³Ø§Ø¹ÙØªÙ Ø´ÙØ´ Ø¨ÛŒØ¯Ø§Ø± Ø´ÙØ¯ÙÙ… Ùˆ Ø³Ø§Ø¹ÙØªÙ Ù‡ÙÙØª ØµÙØ¨Ø­Ø§Ù†ÙÙ‡ Ø®ÙÙˆØ±Ø¯ÙÙ…. ÛŒÙØ¹Ø¯ Ø¨Ø§ Ø§ÙØªÙˆØ¨ÙˆØ³ Ø¨Ù‡ Ø¯Ø§Ù†ÙØ´Ú¯Ø§Ù‡ Ø±ÙÙØªÙÙ…. Ø¯Ø± Ø¯Ø§Ù†ÙØ´Ú¯Ø§Ù‡ Ø§Ø² Ø³Ø§Ø¹ÙØªÙ Ù‡ÙØ´Øª ØªØ§ Ø³Ø§Ø¹ÙØªÙ Ø¯ÙÙ‡ ÛŒÚ© Ú©ÙÙ„Ø§Ø³ Ø¯Ø§Ø´ØªÙÙ…. Ø¨ÙØ¹Ø¯ Ø¨Ø§ Ø¯ÙˆØ³ØªÙÙ… Ù‚ÙÙ‡ÙˆÙ‡ Ù†ÙˆØ´ÛŒØ¯ÙÙ… Ùˆ Ø­ÙØ±Ù Ø²ÙØ¯ÛŒÙ…. Ø¨ÙØ¹Ø¯ Ø¨Ù‡ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø±ÙÙØªÙÙ… Ùˆ Ø¯Ùˆ Ø³Ø§Ø¹ÙØª Ø¯ÙØ±Ø³ Ø®ÙˆØ§Ù†ÙØ¯Ù…. Ø¸ÙÙ‡Ø± Ø¨Ù‡ Ø®Ø§Ù†Ù‡ Ø¨Ø±ÙÚ¯ÙØ´ØªÙ… Ùˆ Ù†Ø§Ù‡Ø§Ø± Ø®ÙˆØ±Ø¯ÙÙ…. Ø¨ÙØ¹Ø¯ Ù…ÙˆØ³ÛŒÙ‚ÛŒ Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù…. Ø¹ÙØµØ± Ø®Ø±ÛŒØ¯ Ø±ÙÙØªÙÙ… Ùˆ Ù…ÛŒÙˆÙÙ‡ Ùˆ Ù†Ø§Ù† Ø®Ø±ÛŒØ¯Ù…. Ø´ÙØ¨ Ø´Ø§Ù… Ø¯ÙØ±ÙØ³Øª Ú©ÙØ±Ø¯Ù…. Ø³Ø§Ø¹Øª Ù†ÙÙ‡ Ø´Ø§Ù… Ø®ÙˆØ±Ø¯Ù… Ùˆ ÛŒÚ© ÙÛŒÙ„Ù… Ø¯ÛŒØ¯ÙÙ…. Ø³Ø§Ø¹ØªÙ Ø¯ÙÙ‡ Ø®ÙˆØ§Ø¨ÛŒØ¯Ù….';

        // Vokabeldaten fÃ¼r Flashcards
        const vocabularyData = {
            'Familie': [
                { german: 'die Familie', persian: 'Ø®Ø§Ù†ÙÙˆØ§Ø¯Ù‡', transcription: 'á¸«ÄnevÄde' },
                { german: 'der Vater', persian: 'Ù¾ÙØ¯ÙØ±', transcription: 'pedar' },
                { german: 'die Mutter', persian: 'Ù…Ø§Ø¯ÙØ±', transcription: 'mÄdar' },
                { german: 'die Eltern', persian: 'Ù¾Ø¯Ø± Ùˆ Ù…Ø§Ø¯Ø±', transcription: 'pedar-o mÄdar' },
                { german: 'der Bruder', persian: 'Ø¨Ø±Ø§Ø¯ÙØ±', transcription: 'barÄdar' },
                { german: 'die Schwester', persian: 'Ø®ÙˆØ§Ù‡ÙØ±', transcription: 'á¸«Ähar' },
                { german: 'der Sohn', persian: 'Ù¾ÙØ³ÙØ±', transcription: 'pesar' },
                { german: 'die Tochter', persian: 'Ø¯ÙØ®ØªÙØ±', transcription: 'doá¸«tar' },
                { german: 'der GroÃŸvater', persian: 'Ù¾Ø¯Ø±Ø¨ÙØ²ÙØ±Ú¯', transcription: 'pedar-bozorg' },
                { german: 'die GroÃŸmutter', persian: 'Ù…Ø§Ø¯Ø±Ø¨ÙØ²ÙØ±Ú¯', transcription: 'mÄdar-bozorg' },
                { german: 'das Kind', persian: 'Ø¨Ú†Ù‡â€Œ', transcription: 'baÄÄe' }
            ],
            'Eigenschaften': [
                { german: 'groÃŸ', persian: 'Ù‚ÙØ¯Ø¨ÙÙ„ÙÙ†Ø¯', transcription: 'qad-boland' },
                { german: 'klein', persian: 'Ù‚ÙØ¯Ú©ÙˆØªØ§Ù‡', transcription: 'qad-kutÄh' },
                { german: 'dick', persian: 'Ú†Ø§Ù‚', transcription: 'ÄÄq' },
                { german: 'dÃ¼nn', persian: 'Ù„Ø§ØºÙØ±', transcription: 'lÄÄ¡ar' },
                { german: 'schÃ¶n', persian: 'Ø²ÛŒØ¨Ø§', transcription: 'zibÄ' },
                { german: 'freundlich', persian: 'Ù…ÙÙ‡Ø±ÙØ¨Ø§Ù†', transcription: 'mehrabÄn' }
            ],
            'Haut & Augen': [
                { german: 'helle Haut', persian: 'Ù¾ÙˆØ³ØªÙ Ø±ÙˆØ´Ù†', transcription: 'pÅ«st-e roÅ¡an' },
                { german: 'dunkle Haut', persian: 'Ù¾ÙˆØ³ØªÙ ØªÛŒØ±Ù‡', transcription: 'pÅ«st-e tÄ«re' },
                { german: 'braune Haut', persian: 'Ù¾ÙˆØ³ØªÙ Ù‚ÙÙ‡ÙˆÙ‡â€ŒØ§ÛŒ', transcription: 'pÅ«st-e qahve-Ê¾i' },
                { german: 'blaue Augen', persian: 'Ú†Ø´Ù…â€ŒÙ‡Ø§ÛŒ Ø¢Ø¨ÛŒ', transcription: 'ÄeÅ¡mhÄ-ye Äbi' },
                { german: 'grÃ¼ne Augen', persian: 'Ú†Ø´Ù…â€ŒÙ‡Ø§ÛŒ Ø³ÙØ¨Ø²', transcription: 'ÄeÅ¡mhÄ-ye sabz' },
                { german: 'braune Augen', persian: 'Ú†Ø´Ù…â€ŒÙ‡Ø§ÛŒ Ù‚ÙÙ‡ÙˆÙ‡â€ŒØ§ÛŒ', transcription: 'ÄeÅ¡mhÄ-ye qahve-Ê¾i' },
                { german: 'schwarze Augen', persian: 'Ú†Ø´Ù…â€ŒÙ‡Ø§ÛŒ Ù…ÙØ´Ú©ÛŒ', transcription: 'ÄeÅ¡mhÄ-ye meÅ¡ki' }
            ],
            'Haare': [
                { german: 'die Haare', persian: 'Ù…Ùˆ', transcription: 'mu' },
                { german: 'lange Haare', persian: 'Ù…ÙˆÛŒÙ Ø¨Ù„Ù†Ø¯', transcription: 'mu-ye boland' },
                { german: 'kurze Haare', persian: 'Ù…ÙˆÛŒÙ Ú©ÙˆØªØ§Ù‡', transcription: 'mu-ye kutÄh' },
                { german: 'glatte Haare', persian: 'Ù…ÙˆÛŒÙ ØµØ§Ù', transcription: 'mu-ye sÄf' },
                { german: 'lockige Haare', persian: 'Ù…ÙˆÛŒÙ ÙÙØ±', transcription: 'mu-ye fer' },
                { german: 'schwarze Haare', persian: 'Ù…ÙˆÛŒÙ Ù…ÙØ´Ú©ÛŒ', transcription: 'mu-ye meÅ¡ki' },
                { german: 'braune Haare', persian: 'Ù…ÙˆÛŒÙÙ Ù‚ÙÙ‡ÙˆÙ‡â€ŒØ§ÛŒ', transcription: 'mu-ye qahve-Ê¾i' },
                { german: 'blonde Haare', persian: 'Ù…ÙˆÛŒ Ø¨Ù„ÙˆÙ†Ø¯', transcription: 'mu-ye bolond' },
                { german: 'graue Haare', persian: 'Ù…ÙˆÛŒ Ø®Ø§Ú©ÙØ³ØªÙØ±ÛŒ', transcription: 'mu-ye á¸«Äkestari' }
            ],
            'Zeit': [
                { german: 'gestern', persian: 'Ø¯ÛŒØ±ÙˆØ²', transcription: 'dÄ«rÅ«z' },
                { german: 'Morgen', persian: 'ØµÙØ¨Ø­', transcription: 'sobh' },
                { german: 'Mittag', persian: 'Ø¸ÙÙ‡Ø±', transcription: 'zohr' },
                { german: 'Nachmittag', persian: 'Ø¹ÙØµØ±', transcription: 'asr' },
                { german: 'Abend', persian: 'Ø´ÙØ¨', transcription: 'Å¡ab' },
                { german: 'Uhrzeit', persian: 'Ø³Ø§Ø¹Øª', transcription: 'sÄÊ¿at' }
            ],
            'Essen': [
                { german: 'FrÃ¼hstÃ¼ck', persian: 'ØµÙØ¨Ø­Ø§Ù†ÙÙ‡', transcription: 'sobá¸¥Äne' },
                { german: 'Mittagessen', persian: 'Ù†Ø§Ù‡Ø§Ø±', transcription: 'nÄhÄr' },
                { german: 'Abendessen', persian: 'Ø´Ø§Ù…', transcription: 'Å¡Äm' },
                { german: 'Kaffee', persian: 'Ù‚ÙÙ‡ÙˆÙÙ‡', transcription: 'qahve' },
                { german: 'Obst', persian: 'Ù…ÛŒÙˆÙÙ‡', transcription: 'mÄ«ve' },
                { german: 'Brot', persian: 'Ù†Ø§Ù†', transcription: 'nÄn' }
            ],
            'Orte': [
                { german: 'Haus', persian: 'Ø®Ø§Ù†ÙÙ‡', transcription: 'á¸«Äne' },
                { german: 'UniversitÃ¤t', persian: 'Ø¯Ø§Ù†ÙØ´Ú¯Ø§Ù‡', transcription: 'dÄneÅ¡gÄh' },
                { german: 'Bibliothek', persian: 'Ú©ÙØªØ§Ø¨Ø®Ø§Ù†Ù‡', transcription: 'ketÄbá¸«Äne' },
                { german: 'Kurs', persian: 'Ú©ÙÙ„Ø§Ø³', transcription: 'kelÄs' }
            ],
            'Personen': [
                { german: 'Student/in', persian: 'Ø¯Ø§Ù†ÙØ´Ø¬Ùˆ', transcription: 'dÄneÅ¡Ç§Å«' },
                { german: 'Freund/in', persian: 'Ø¯ÙˆØ³Øª', transcription: 'dust' }
            ],
            'Verben': [
                { german: 'sein', persian: 'Ø¨ÙˆØ¯ÙÙ†', transcription: 'budan' },
                { german: 'gehen', persian: 'Ø±ÙÙØªÙ†', transcription: 'raftan' },
                { german: 'essen', persian: 'Ø®ÙˆØ±Ø¯ÙÙ†', transcription: 'á¸«ordan' },
                { german: 'trinken', persian: 'Ù†ÙˆØ´ÛŒØ¯ÙÙ†', transcription: 'nuÅ¡Ä«dan' },
                { german: 'lesen', persian: 'Ø®ÙˆØ§Ù†Ø¯ÙÙ†', transcription: 'á¸«Ändan' },
                { german: 'haben', persian: 'Ø¯Ø§Ø´ØªÙÙ†', transcription: 'dÄÅ¡tan' },
                { german: 'sagen', persian: 'Ú¯ÙÙØªÙÙ†', transcription: 'goftan' },
                { german: 'hÃ¶ren', persian: 'Ø´ÙÙ†ÛŒØ¯ÙÙ†', transcription: 'Å¡enÄ«dan' },
                { german: 'machen', persian: 'Ø¯ÙØ±ÙØ³Øª Ú©ÙØ±Ø¯ÙÙ†', transcription: 'dorost kardan' },
                { german: 'kaufen', persian: 'Ø®ÙØ±ÛŒØ¯ÙÙ†', transcription: 'á¸«arÄ«dan' },
                { german: 'schlafen', persian: 'Ø®ÙˆØ§Ø¨ÛŒØ¯ÙÙ†', transcription: 'á¸«ÄbÄ«dan' },
                { german: 'zurÃ¼ckkehren', persian: 'Ø¨ÙØ±Ú¯ÙØ´ØªÙÙ†', transcription: 'bargaÅ¡tan' },
                { german: 'aufwachen', persian: 'Ø¨ÛŒØ¯Ø§Ø± Ø´ÙØ¯ÙÙ†', transcription: 'bidÄr Å¡odan' },
                { german: 'zuhÃ¶ren', persian: 'Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù†', transcription: 'guÅ¡ dÄdan' },
                { german: 'sehen', persian: 'Ø¯ÛŒØ¯Ù†', transcription: 'dÄ«dan' }
            ],
            'Zahlen': [
                { german: 'eins', persian: 'ÛŒÚ©', transcription: 'yek' },
                { german: 'zwei', persian: 'Ø¯Ùˆ', transcription: 'do' },
                { german: 'drei', persian: 'Ø³Ù‡', transcription: 'se' },
                { german: 'vier', persian: 'Ú†ÙÙ‡Ø§Ø±', transcription: 'ÄahÄr' },
                { german: 'fÃ¼nf', persian: 'Ù¾ÙÙ†Ø¬', transcription: 'panj' },
                { german: 'sechs', persian: 'Ø´Ø´', transcription: 'Å¡eÅ¡' },
                { german: 'sieben', persian: 'Ù‡ÙØª', transcription: 'haft' },
                { german: 'acht', persian: 'Ù‡Ø´Øª', transcription: 'haÅ¡t' },
                { german: 'neun', persian: 'Ù†Ù‡', transcription: 'noh' },
                { german: 'zehn', persian: 'Ø¯Ù‡', transcription: 'dah' }
            ]
        };

        // Flashcards State
        let currentCategory = 'Familie';
        let currentCardIndex = 0;
        let currentCards = [];

        function initFlashcards() {
            // Erstelle Kategorie-Buttons
            const selector = document.getElementById('categorySelector');
            selector.innerHTML = '';
            
            for (const category of Object.keys(vocabularyData)) {
                const btn = document.createElement('button');
                btn.className = 'category-btn';
                if (category === currentCategory) btn.classList.add('active');
                btn.textContent = category;
                btn.onclick = () => selectCategory(category);
                selector.appendChild(btn);
            }
            
            loadCategory(currentCategory);
        }

        function selectCategory(category) {
            currentCategory = category;
            currentCardIndex = 0;
            
            // Update Button-Styles
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === category) btn.classList.add('active');
            });
            
            loadCategory(category);
        }

        function loadCategory(category) {
            currentCards = vocabularyData[category];
            showCard(0);
        }

        function showCard(index) {
            if (index < 0 || index >= currentCards.length) return;
            
            currentCardIndex = index;
            const card = currentCards[index];
            
            // Reset flip
            document.getElementById('flashcard').classList.remove('flipped');
            
            // Update content
            document.getElementById('cardFront').textContent = card.german;
            document.getElementById('cardBack').textContent = card.persian;
            document.getElementById('cardTranscription').textContent = card.transcription;
            
            // Update counter
            document.getElementById('cardCounter').textContent = `${index + 1} / ${currentCards.length}`;
            
            // Update buttons
            document.getElementById('prevBtn').disabled = (index === 0);
            document.getElementById('nextBtn').disabled = (index === currentCards.length - 1);
        }

        function flipCard() {
            document.getElementById('flashcard').classList.toggle('flipped');
        }

        function previousCard() {
            if (currentCardIndex > 0) {
                showCard(currentCardIndex - 1);
            }
        }

        function nextCard() {
            if (currentCardIndex < currentCards.length - 1) {
                showCard(currentCardIndex + 1);
            }
        }

        // Text Section
        let textInitialized = false;
        
        function initTextSection() {
            if (textInitialized) return;
            textInitialized = true;
            
            const textDiv = document.getElementById('persianText');
            const words = fullText.split(' ');
            
            words.forEach(word => {
                const span = document.createElement('span');
                span.className = 'persian-word';
                span.textContent = word + ' ';
                span.onclick = (e) => showTooltip(e, word);
                textDiv.appendChild(span);
            });

            // Richtig/Falsch Fragen
            const tfQuestions = [
                { text: 'Ù…ÛŒÙ†Ø§ Ø¯ÛŒØ±ÙˆØ² Ø³Ø§Ø¹Øª Ù‡ÙØª Ø¨ÛŒØ¯Ø§Ø± Ø´ÙØ¯.', answer: false },
                { text: 'Ø§Ùˆ Ø¨Ø§ Ø¯ÙˆØ³ØªØ´ Ù‚Ù‡ÙˆÙ‡ Ù†ÙˆØ´ÛŒØ¯.', answer: true },
                { text: 'Ù…ÛŒÙ†Ø§ Ø§Ø² Ø³Ø§Ø¹Øª Ù†ÙÙ‡ Ú©Ù„Ø§Ø³ Ø¯Ø§Ø´Øª.', answer: false },
                { text: 'Ù…ÛŒÙ†Ø§ Ø¨Ù‡ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù†ÙØ±ÙÙØª.', answer: false },
                { text: 'Ù…ÛŒÙ†Ø§ Ø´Ø¨ Ø³Ø§Ø¹ÙØªÙ Ø¯ÙÙ‡ Ø®ÙˆØ§Ø¨ÛŒØ¯.', answer: true }
            ];

            const tfDiv = document.getElementById('truefalseQuestions');
            tfQuestions.forEach((q, i) => {
                const qDiv = document.createElement('div');
                qDiv.className = 'question';
                qDiv.innerHTML = `
                    <div class="question-text persian-question">${q.text}</div>
                    <div class="answer-options">
                        <button class="btn btn-yes" onclick="answerTF(${i}, true)">âœ“ Richtig</button>
                        <button class="btn btn-no" onclick="answerTF(${i}, false)">âœ— Falsch</button>
                    </div>
                    <div class="feedback" id="tf-feedback-${i}"></div>
                `;
                tfDiv.appendChild(qDiv);
            });

            // Offene Fragen
            const openQuestions = [
                { text: 'Ù…ÛŒÙ†Ø§ Ú©ÙÛŒ Ø¨ÛŒØ¯Ø§Ø± Ø´ÙØ¯ØŸ', answers: ['Ø³Ø§Ø¹Øª Ø´Ø´', 'Ø´Ø´', '6'] },
                { text: 'Ø§Ùˆ Ø¨Ø§ Ú†ÛŒ Ø¨Ù‡ Ø¯Ø§Ù†ÙØ´Ú¯Ø§Ù‡ Ø±ÙÙØªØŸ', answers: ['Ø§ØªÙˆØ¨ÙˆØ³', 'Ø¨Ø§ Ø§ØªÙˆØ¨ÙˆØ³', 'bus'] },
                { text: 'Ø¨ÙØ¹Ø¯ Ø§Ø² Ú©ÙÙ„Ø§Ø³ Ú©ÙØ¬Ø§ Ø±ÙÙØªØŸ', answers: ['Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡', 'Ø¨Ù‡ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡'] },
                { text: 'Ø¹ÙØµØ± Ú†Ù‡ Ú©Ø§Ø± Ú©ÙØ±Ø¯ØŸ', answers: ['Ø®Ø±ÛŒØ¯ Ø±ÙØª', 'Ø®Ø±ÛŒØ¯', 'Ù…ÛŒÙˆÙ‡ Ùˆ Ù†Ø§Ù† Ø®Ø±ÛŒØ¯', 'Ø®Ø±ÛŒØ¯ Ú©Ø±Ø¯'] },
                { text: 'Ú†Ù‡ Ø³Ø§Ø¹ØªÛŒ Ø®ÙˆØ§Ø¨ÛŒØ¯ØŸ', answers: ['Ø³Ø§Ø¹Øª Ø¯Ù‡', 'Ø¯Ù‡', '10'] }
            ];

            const openDiv = document.getElementById('openQuestions');
            openQuestions.forEach((q, i) => {
                const qDiv = document.createElement('div');
                qDiv.className = 'question';
                qDiv.innerHTML = `
                    <div class="question-text persian-question">${q.text}</div>
                    <input type="text" id="open-${i}" placeholder="Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...">
                    <div class="feedback" id="open-feedback-${i}"></div>
                `;
                openDiv.appendChild(qDiv);
            });
        }

        let tfAnswers = {};
        function answerTF(index, answer) {
            tfAnswers[index] = answer;
        }

        const tfCorrectAnswers = [false, true, false, false, true];
        const openCorrectAnswers = [
            ['Ø³Ø§Ø¹Øª Ø´Ø´', 'Ø´Ø´', '6', 'ØµØ¨Ø­ Ø³Ø§Ø¹Øª Ø´Ø´'],
            ['Ø§ØªÙˆØ¨ÙˆØ³', 'Ø¨Ø§ Ø§ØªÙˆØ¨ÙˆØ³', 'bus', 'Ø§ØªÙˆØ¨ÙˆØ³ Ø¨Ù‡ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø±ÙØª'],
            ['Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡', 'Ø¨Ù‡ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡', 'Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø±ÙØª'],
            ['Ø®Ø±ÛŒØ¯ Ø±ÙØª', 'Ø®Ø±ÛŒØ¯', 'Ù…ÛŒÙˆÙ‡ Ùˆ Ù†Ø§Ù† Ø®Ø±ÛŒØ¯', 'Ø®Ø±ÛŒØ¯ Ú©Ø±Ø¯', 'Ø®Ø±ÛŒØ¯ Ø±ÙØªÙ…'],
            ['Ø³Ø§Ø¹Øª Ø¯Ù‡', 'Ø¯Ù‡', '10', 'Ø´Ø¨ Ø³Ø§Ø¹Øª Ø¯Ù‡']
        ];

        function normalizeAnswer(answer) {
            return answer
                .toLowerCase()
                .replace(/[Û°-Û¹]/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'.indexOf(d))
                .replace(/[Ù -Ù©]/g, d => 'Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'.indexOf(d))
                .replace(/[\u064B-\u065F\u0670]/g, '')
                .replace(/[.!?ØŒØ›]/g, '')
                .replace(/\s+/g, '')
                .trim();
        }

        function checkTextAnswers() {
            let tfScore = 0;
            let openScore = 0;

            for (let i = 0; i < 5; i++) {
                const feedback = document.getElementById(`tf-feedback-${i}`);
                if (tfAnswers[i] === tfCorrectAnswers[i]) {
                    feedback.textContent = 'âœ“ Richtig!';
                    feedback.className = 'feedback correct';
                    tfScore++;
                } else {
                    feedback.textContent = 'âœ— Falsch';
                    feedback.className = 'feedback incorrect';
                }
                feedback.style.display = 'block';
            }

            for (let i = 0; i < 5; i++) {
                const input = document.getElementById(`open-${i}`);
                const feedback = document.getElementById(`open-feedback-${i}`);
                const userAnswer = normalizeAnswer(input.value);
                
                let isCorrect = false;
                for (let correctAnswer of openCorrectAnswers[i]) {
                    if (normalizeAnswer(correctAnswer).includes(userAnswer) || 
                        userAnswer.includes(normalizeAnswer(correctAnswer))) {
                        isCorrect = true;
                        break;
                    }
                }

                if (isCorrect) {
                    feedback.textContent = 'âœ“ Richtig!';
                    feedback.className = 'feedback correct';
                    openScore++;
                } else {
                    feedback.textContent = 'âœ— Versuche es nochmal';
                    feedback.className = 'feedback incorrect';
                }
                feedback.style.display = 'block';
            }

            const totalScore = tfScore + openScore;
            const scoreDiv = document.getElementById('textScore');
            scoreDiv.textContent = `Ergebnis: ${totalScore} / 10 Punkten (${Math.round(totalScore/10*100)}%)`;
            scoreDiv.style.display = 'block';
        }

        function showTooltip(event, word) {
            const existingTooltip = document.querySelector('.tooltip');
            if (existingTooltip) existingTooltip.remove();

            const cleanWord = word.replace(/[.!?ØŒØ›]/g, '').trim();
            const translation = vocabulary[cleanWord] || 'Keine Ãœbersetzung verfÃ¼gbar';

            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            tooltip.textContent = translation;
            document.body.appendChild(tooltip);

            const rect = event.target.getBoundingClientRect();
            tooltip.style.left = rect.left + 'px';
            tooltip.style.top = (rect.bottom + 5) + 'px';

            setTimeout(() => tooltip.remove(), 3000);
        }

        // Satzbau
        const sentenceExercises = [
            { 
                german: 'Ich wachte gestern um sechs Uhr auf.',
                persian: ['Ù…Ù†', 'Ø¯ÛŒØ±ÙˆØ²', 'Ø³Ø§Ø¹Øª', 'Ø´Ø´', 'Ø¨ÛŒØ¯Ø§Ø±', 'Ø´Ø¯Ù…'],
                distractors: ['ØµØ¨Ø­Ø§Ù†Ù‡', 'Ø±ÙØªÙ…', 'Ø®ÙˆØ±Ø¯Ù…']
            },
            { 
                german: 'Ich aÃŸ FrÃ¼hstÃ¼ck um sieben Uhr.',
                persian: ['Ù…Ù†', 'Ø³Ø§Ø¹Øª', 'Ù‡ÙØª', 'ØµØ¨Ø­Ø§Ù†Ù‡', 'Ø®ÙˆØ±Ø¯Ù…'],
                distractors: ['Ø¯ÛŒØ¯Ù…', 'Ù†ÙˆØ´ÛŒØ¯Ù…', 'Ø´Ø´']
            },
            { 
                german: 'Ich ging mit dem Bus zur UniversitÃ¤t.',
                persian: ['Ù…Ù†', 'Ø¨Ø§', 'Ø§ØªÙˆØ¨ÙˆØ³', 'Ø¨Ù‡', 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡', 'Ø±ÙØªÙ…'],
                distractors: ['Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡', 'Ø®Ø§Ù†Ù‡', 'Ø¨Ø±Ú¯Ø´ØªÙ…']
            },
            { 
                german: 'Ich hatte einen Kurs von acht bis zehn Uhr.',
                persian: ['Ù…Ù†', 'Ø§Ø²', 'Ø³Ø§Ø¹Øª', 'Ù‡Ø´Øª', 'ØªØ§', 'Ø³Ø§Ø¹Øª', 'Ø¯Ù‡', 'ÛŒÚ©', 'Ú©Ù„Ø§Ø³', 'Ø¯Ø§Ø´ØªÙ…'],
                distractors: ['Ø¯Ùˆ', 'Ø³Ù‡', 'Ø±ÙØªÙ…']
            },
            { 
                german: 'Ich trank Kaffee mit meinem Freund.',
                persian: ['Ù…Ù†', 'Ø¨Ø§', 'Ø¯ÙˆØ³ØªÙ…', 'Ù‚Ù‡ÙˆÙ‡', 'Ù†ÙˆØ´ÛŒØ¯Ù…'],
                distractors: ['Ø®ÙˆØ±Ø¯Ù…', 'Ø¯ÛŒØ¯Ù…', 'Ø´Ø§Ù…']
            },
            { 
                german: 'Wir sprachen zusammen.',
                persian: ['Ù…Ø§', 'Ø­Ø±Ù', 'Ø²Ø¯ÛŒÙ…'],
                distractors: ['Ù…Ù†', 'Ø²Ø¯Ù…', 'Ø®ÙˆØ±Ø¯ÛŒÙ…']
            },
            { 
                german: 'Ich ging zur Bibliothek.',
                persian: ['Ù…Ù†', 'Ø¨Ù‡', 'Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡', 'Ø±ÙØªÙ…'],
                distractors: ['Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡', 'Ø®Ø§Ù†Ù‡', 'Ø¨Ø±Ú¯Ø´ØªÙ…']
            },
            { 
                german: 'Ich lernte zwei Stunden.',
                persian: ['Ù…Ù†', 'Ø¯Ùˆ', 'Ø³Ø§Ø¹Øª', 'Ø¯Ø±Ø³', 'Ø®ÙˆØ§Ù†Ø¯Ù…'],
                distractors: ['Ø³Ù‡', 'Ø®ÙˆØ±Ø¯Ù…', 'ÛŒÚ©']
            },
            { 
                german: 'Mittags kehrte ich nach Hause zurÃ¼ck.',
                persian: ['Ø¸Ù‡Ø±', 'Ù…Ù†', 'Ø¨Ù‡', 'Ø®Ø§Ù†Ù‡', 'Ø¨Ø±Ú¯Ø´ØªÙ…'],
                distractors: ['Ø±ÙØªÙ…', 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡', 'ØµØ¨Ø­']
            },
            { 
                german: 'Ich aÃŸ Mittagessen.',
                persian: ['Ù…Ù†', 'Ù†Ø§Ù‡Ø§Ø±', 'Ø®ÙˆØ±Ø¯Ù…'],
                distractors: ['Ø´Ø§Ù…', 'ØµØ¨Ø­Ø§Ù†Ù‡', 'Ù†ÙˆØ´ÛŒØ¯Ù…']
            },
            { 
                german: 'Ich hÃ¶rte Musik.',
                persian: ['Ù…Ù†', 'Ù…ÙˆØ³ÛŒÙ‚ÛŒ', 'Ú¯ÙˆØ´', 'Ø¯Ø§Ø¯Ù…'],
                distractors: ['Ø¯ÛŒØ¯Ù…', 'Ø®ÙˆØ§Ù†Ø¯Ù…', 'ÙÛŒÙ„Ù…']
            },
            { 
                german: 'Nachmittags ging ich einkaufen.',
                persian: ['Ø¹ØµØ±', 'Ù…Ù†', 'Ø®Ø±ÛŒØ¯', 'Ø±ÙØªÙ…'],
                distractors: ['Ø¸Ù‡Ø±', 'ØµØ¨Ø­', 'Ø¨Ø±Ú¯Ø´ØªÙ…']
            },
            { 
                german: 'Ich kaufte Obst und Brot.',
                persian: ['Ù…Ù†', 'Ù…ÛŒÙˆÙ‡', 'Ùˆ', 'Ù†Ø§Ù†', 'Ø®Ø±ÛŒØ¯Ù…'],
                distractors: ['Ù‚Ù‡ÙˆÙ‡', 'Ø®ÙˆØ±Ø¯Ù…', 'Ø´Ø§Ù…']
            },
            { 
                german: 'Abends kochte ich Abendessen.',
                persian: ['Ø´Ø¨', 'Ù…Ù†', 'Ø´Ø§Ù…', 'Ø¯Ø±Ø³Øª', 'Ú©Ø±Ø¯Ù…'],
                distractors: ['Ø®ÙˆØ±Ø¯Ù…', 'Ù†Ø§Ù‡Ø§Ø±', 'ØµØ¨Ø­Ø§Ù†Ù‡']
            },
            { 
                german: 'Ich aÃŸ Abendessen um neun Uhr.',
                persian: ['Ù…Ù†', 'Ø³Ø§Ø¹Øª', 'Ù†Ù‡', 'Ø´Ø§Ù…', 'Ø®ÙˆØ±Ø¯Ù…'],
                distractors: ['Ø¯Ù‡', 'Ù‡Ø´Øª', 'Ù†ÙˆØ´ÛŒØ¯Ù…']
            },
            { 
                german: 'Ich sah einen Film.',
                persian: ['Ù…Ù†', 'ÛŒÚ©', 'ÙÛŒÙ„Ù…', 'Ø¯ÛŒØ¯Ù…'],
                distractors: ['Ø¯Ùˆ', 'Ù…ÙˆØ³ÛŒÙ‚ÛŒ', 'Ø´Ù†ÛŒØ¯Ù…']
            },
            { 
                german: 'Ich schlief um zehn Uhr.',
                persian: ['Ù…Ù†', 'Ø³Ø§Ø¹Øª', 'Ø¯Ù‡', 'Ø®ÙˆØ§Ø¨ÛŒØ¯Ù…'],
                distractors: ['Ù†Ù‡', 'Ø¨ÛŒØ¯Ø§Ø±', 'Ø´Ø¯Ù…']
            },
            { 
                german: 'Ich ging gestern zur UniversitÃ¤t.',
                persian: ['Ù…Ù†', 'Ø¯ÛŒØ±ÙˆØ²', 'Ø¨Ù‡', 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡', 'Ø±ÙØªÙ…'],
                distractors: ['Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡', 'Ø¨Ø±Ú¯Ø´ØªÙ…', 'Ø§Ù…Ø±ÙˆØ²']
            },
            { 
                german: 'Wir tranken zusammen Kaffee.',
                persian: ['Ù…Ø§', 'Ù‚Ù‡ÙˆÙ‡', 'Ù†ÙˆØ´ÛŒØ¯ÛŒÙ…'],
                distractors: ['Ù…Ù†', 'Ù†ÙˆØ´ÛŒØ¯Ù…', 'Ø®ÙˆØ±Ø¯ÛŒÙ…']
            },
            { 
                german: 'Ich hatte gestern einen Kurs.',
                persian: ['Ù…Ù†', 'Ø¯ÛŒØ±ÙˆØ²', 'ÛŒÚ©', 'Ú©Ù„Ø§Ø³', 'Ø¯Ø§Ø´ØªÙ…'],
                distractors: ['Ø¯Ùˆ', 'Ø§Ù…Ø±ÙˆØ²', 'Ø¯Ø§Ø´ØªÛŒÙ…']
            }
        ];

        let currentSentence = 0;
        let sentenceScore = 0;
        let selectedWords = [];

        function initSentenceBuilder() {
            showSentenceExercise();
        }

        function showSentenceExercise() {
            if (currentSentence >= sentenceExercises.length) {
                showSentenceResults();
                return;
            }

            const exercise = sentenceExercises[currentSentence];
            document.getElementById('sentenceTask').textContent = exercise.german;
            document.getElementById('sentenceBuilder').innerHTML = '';
            selectedWords = [];

            const allWords = [...exercise.persian, ...exercise.distractors];
            shuffleArray(allWords);

            const wordBank = document.getElementById('wordBank');
            wordBank.innerHTML = '';
            allWords.forEach(word => {
                const chip = document.createElement('div');
                chip.className = 'word-chip';
                chip.textContent = word;
                chip.onclick = () => selectWord(word, chip);
                wordBank.appendChild(chip);
            });

            document.getElementById('sentenceFeedback').style.display = 'none';
            document.getElementById('sentenceNext').style.display = 'none';
            
            updateSentenceProgress();
        }

        function selectWord(word, chip) {
            if (chip.classList.contains('selected')) {
                const index = selectedWords.indexOf(word);
                if (index > -1) {
                    selectedWords.splice(index, 1);
                }
                chip.classList.remove('selected');
            } else {
                selectedWords.push(word);
                chip.classList.add('selected');
            }

            const builder = document.getElementById('sentenceBuilder');
            builder.innerHTML = selectedWords.map(w => `<span class="word-chip selected">${w}</span>`).join(' ');
        }

        function checkSentence() {
            const exercise = sentenceExercises[currentSentence];
            const feedback = document.getElementById('sentenceFeedback');
            
            const isCorrect = JSON.stringify(selectedWords) === JSON.stringify(exercise.persian);

            if (isCorrect) {
                feedback.textContent = 'âœ“ Perfekt! Der Satz ist richtig.';
                feedback.className = 'feedback correct';
                sentenceScore++;
            } else {
                feedback.textContent = `âœ— Nicht ganz. Richtig wÃ¤re: ${exercise.persian.join(' ')}`;
                feedback.className = 'feedback incorrect';
            }
            feedback.style.display = 'block';
            document.getElementById('sentenceNext').style.display = 'block';
        }

        function nextSentence() {
            currentSentence++;
            showSentenceExercise();
        }

        function showSentenceResults() {
            document.querySelector('#page-sentence .question').style.display = 'none';
            document.querySelector('#page-sentence .btn-check').style.display = 'none';
            const scoreDiv = document.getElementById('sentenceScore');
            scoreDiv.textContent = `Ergebnis: ${sentenceScore} / ${sentenceExercises.length} richtig (${Math.round(sentenceScore/sentenceExercises.length*100)}%)`;
            scoreDiv.style.display = 'block';
        }

        function updateSentenceProgress() {
            const progress = document.getElementById('sentenceProgress');
            const percent = (currentSentence / sentenceExercises.length) * 100;
            progress.style.width = percent + '%';
            progress.textContent = `${currentSentence} / ${sentenceExercises.length}`;
        }

        // LÃ¼ckentext
        const gapTexts = [
            { text: 'Ù…Ù† Ø¯ÛŒØ±ÙˆØ² Ø³Ø§Ø¹Øª Ø´Ø´ Ø¨ÛŒØ¯Ø§Ø± _____ (Ø¨ÛŒØ¯Ø§Ø± Ø´Ø¯Ù†)', answer: 'Ø´Ø¯Ù…', person: 'ich' },
            { text: 'Ø§Ùˆ Ø³Ø§Ø¹Øª Ù‡ÙØª ØµØ¨Ø­Ø§Ù†Ù‡ _____ (Ø®ÙˆØ±Ø¯Ù†)', answer: 'Ø®ÙˆØ±Ø¯', person: 'er/sie' },
            { text: 'Ù…Ø§ Ø¨Ø§ Ø§ØªÙˆØ¨ÙˆØ³ Ø¨Ù‡ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ _____ (Ø±ÙØªÙ†)', answer: 'Ø±ÙØªÛŒÙ…', person: 'wir' },
            { text: 'ØªÙˆ Ú©ÛŒ Ø¨Ù‡ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ _____ØŸ (Ø±ÙØªÙ†)', answer: 'Ø±ÙØªÛŒ', person: 'du' },
            { text: 'Ù…Ù† Ø§Ø² Ø³Ø§Ø¹Øª Ù‡Ø´Øª ØªØ§ Ø¯Ù‡ ÛŒÚ© Ú©Ù„Ø§Ø³ _____ (Ø¯Ø§Ø´ØªÙ†)', answer: 'Ø¯Ø§Ø´ØªÙ…', person: 'ich' },
            { text: 'Ø¢Ù†Ù‡Ø§ Ø¨Ø§ Ø¯ÙˆØ³ØªØ´Ø§Ù† Ù‚Ù‡ÙˆÙ‡ _____ (Ù†ÙˆØ´ÛŒØ¯Ù†)', answer: 'Ù†ÙˆØ´ÛŒØ¯Ù†Ø¯', person: 'sie (Pl.)' },
            { text: 'Ø´Ù…Ø§ Ø­Ø±Ù _____ØŸ (Ø²Ø¯Ù†)', answer: 'Ø²Ø¯ÛŒØ¯', person: 'ihr' },
            { text: 'Ø§Ùˆ Ø¯Ùˆ Ø³Ø§Ø¹Øª Ø¯Ø±Ø³ _____ (Ø®ÙˆØ§Ù†Ø¯Ù†)', answer: 'Ø®ÙˆØ§Ù†Ø¯', person: 'er/sie' },
            { text: 'Ù…Ù† Ø¸Ù‡Ø± Ø¨Ù‡ Ø®Ø§Ù†Ù‡ _____ (Ø¨Ø±Ú¯Ø´ØªÙ†)', answer: 'Ø¨Ø±Ú¯Ø´ØªÙ…', person: 'ich' },
            { text: 'Ù…Ø§ Ù†Ø§Ù‡Ø§Ø± _____ (Ø®ÙˆØ±Ø¯Ù†)', answer: 'Ø®ÙˆØ±Ø¯ÛŒÙ…', person: 'wir' },
            { text: 'Ø§Ùˆ Ù…ÙˆØ³ÛŒÙ‚ÛŒ Ú¯ÙˆØ´ _____ (Ø¯Ø§Ø¯Ù†)', answer: 'Ø¯Ø§Ø¯', person: 'er/sie' },
            { text: 'Ù…Ù† Ø¹ØµØ± Ø®Ø±ÛŒØ¯ _____ (Ø±ÙØªÙ†)', answer: 'Ø±ÙØªÙ…', person: 'ich' },
            { text: 'ØªÙˆ Ú†Ù‡ _____ØŸ (Ø®Ø±ÛŒØ¯Ù†)', answer: 'Ø®Ø±ÛŒØ¯ÛŒ', person: 'du' },
            { text: 'Ø§Ùˆ Ø´Ø¨ Ø´Ø§Ù… Ø¯Ø±Ø³Øª _____ (Ú©Ø±Ø¯Ù†)', answer: 'Ú©Ø±Ø¯', person: 'er/sie' },
            { text: 'Ø¢Ù†Ù‡Ø§ Ø³Ø§Ø¹Øª Ù†Ù‡ Ø´Ø§Ù… _____ (Ø®ÙˆØ±Ø¯Ù†)', answer: 'Ø®ÙˆØ±Ø¯Ù†Ø¯', person: 'sie (Pl.)' },
            { text: 'Ù…Ù† ÛŒÚ© ÙÛŒÙ„Ù… _____ (Ø¯ÛŒØ¯Ù†)', answer: 'Ø¯ÛŒØ¯Ù…', person: 'ich' },
            { text: 'ØªÙˆ Ú©ÛŒ _____ØŸ (Ø®ÙˆØ§Ø¨ÛŒØ¯Ù†)', answer: 'Ø®ÙˆØ§Ø¨ÛŒØ¯ÛŒ', person: 'du' },
            { text: 'Ù…Ø§ Ø¯ÛŒØ±ÙˆØ² Ø¨Ù‡ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ _____ (Ø±ÙØªÙ†ØŒ nein)', answer: 'Ù†Ø±ÙØªÛŒÙ…', person: 'wir', negative: true },
            { text: 'Ø§Ùˆ ØµØ¨Ø­Ø§Ù†Ù‡ _____ (Ø®ÙˆØ±Ø¯Ù†ØŒ nein)', answer: 'Ù†Ø®ÙˆØ±Ø¯', person: 'er/sie', negative: true },
            { text: 'Ù…Ù† Ø¨Ù‡ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ _____ (Ø±ÙØªÙ†ØŒ nein)', answer: 'Ù†Ø±ÙØªÙ…', person: 'ich', negative: true }
        ];

        let gapInitialized = false;

        function initGapText() {
            if (gapInitialized) return;
            gapInitialized = true;
            
            const container = document.getElementById('gapQuestions');
            gapTexts.forEach((gap, i) => {
                const qDiv = document.createElement('div');
                qDiv.className = 'question';
                const hint = gap.negative ? ' (Verneinung!)' : '';
                qDiv.innerHTML = `
                    <div class="question-text persian-question">${gap.text}</div>
                    <div class="hint">Person: ${gap.person}${hint}</div>
                    <input type="text" id="gap-${i}" placeholder="ÙØ¹Ù„ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...">
                    <div class="feedback" id="gap-feedback-${i}"></div>
                `;
                container.appendChild(qDiv);
            });
        }

        function checkGapText() {
            let score = 0;
            gapTexts.forEach((gap, i) => {
                const input = document.getElementById(`gap-${i}`);
                const feedback = document.getElementById(`gap-feedback-${i}`);
                const userAnswer = normalizeAnswer(input.value);
                const correctAnswer = normalizeAnswer(gap.answer);

                if (userAnswer === correctAnswer) {
                    feedback.textContent = 'âœ“ Richtig!';
                    feedback.className = 'feedback correct';
                    score++;
                } else {
                    feedback.textContent = `âœ— Richtig wÃ¤re: ${gap.answer}`;
                    feedback.className = 'feedback incorrect';
                }
                feedback.style.display = 'block';
            });

            const scoreDiv = document.getElementById('gapScore');
            scoreDiv.textContent = `Ergebnis: ${score} / ${gapTexts.length} richtig (${Math.round(score/gapTexts.length*100)}%)`;
            scoreDiv.style.display = 'block';

            const progress = document.getElementById('gapProgress');
            progress.style.width = '100%';
            progress.textContent = `${gapTexts.length} / ${gapTexts.length}`;
        }

        // Ãœbersetzung
        const translationExercises = [
            { persian: 'Ù…Ù† Ø¯ÛŒØ±ÙˆØ² Ø³Ø§Ø¹Øª Ø´Ø´ Ø¨ÛŒØ¯Ø§Ø± Ø´Ø¯Ù….', german: 'Ich wachte gestern um sechs Uhr auf.' },
            { persian: 'Ø§Ùˆ Ø³Ø§Ø¹Øª Ù‡ÙØª ØµØ¨Ø­Ø§Ù†Ù‡ Ø®ÙˆØ±Ø¯.', german: 'Er/Sie aÃŸ um sieben Uhr FrÃ¼hstÃ¼ck.' },
            { persian: 'Ù…Ø§ Ø¨Ø§ Ø§ØªÙˆØ¨ÙˆØ³ Ø¨Ù‡ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø±ÙØªÛŒÙ….', german: 'Wir gingen mit dem Bus zur UniversitÃ¤t.' },
            { persian: 'ØªÙˆ Ú©ÛŒ Ø¨Ù‡ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø±ÙØªÛŒØŸ', german: 'Wann gingst du zur Bibliothek?' },
            { persian: 'Ù…Ù† Ø§Ø² Ø³Ø§Ø¹Øª Ù‡Ø´Øª ØªØ§ Ø¯Ù‡ ÛŒÚ© Ú©Ù„Ø§Ø³ Ø¯Ø§Ø´ØªÙ….', german: 'Ich hatte von acht bis zehn Uhr einen Kurs.' },
            { persian: 'Ø¢Ù†Ù‡Ø§ Ø¨Ø§ Ø¯ÙˆØ³ØªØ´Ø§Ù† Ù‚Ù‡ÙˆÙ‡ Ù†ÙˆØ´ÛŒØ¯Ù†Ø¯.', german: 'Sie tranken mit ihrem Freund Kaffee.' },
            { persian: 'Ø´Ù…Ø§ Ú†Ù‡ Ø­Ø±Ù Ø²Ø¯ÛŒØ¯ØŸ', german: 'WorÃ¼ber habt ihr gesprochen?' },
            { persian: 'Ø§Ùˆ Ø¯Ùˆ Ø³Ø§Ø¹Øª Ø¯Ø±Ø³ Ø®ÙˆØ§Ù†Ø¯.', german: 'Er/Sie lernte zwei Stunden.' },
            { persian: 'Ù…Ù† Ø¸Ù‡Ø± Ø¨Ù‡ Ø®Ø§Ù†Ù‡ Ø¨Ø±Ú¯Ø´ØªÙ….', german: 'Ich kehrte mittags nach Hause zurÃ¼ck.' },
            { persian: 'Ù…Ø§ Ù†Ø§Ù‡Ø§Ø± Ø®ÙˆØ±Ø¯ÛŒÙ….', german: 'Wir aÃŸen Mittagessen.' },
            { persian: 'Ø§Ùˆ Ù…ÙˆØ³ÛŒÙ‚ÛŒ Ú¯ÙˆØ´ Ø¯Ø§Ø¯.', german: 'Er/Sie hÃ¶rte Musik.' },
            { persian: 'Ù…Ù† Ø¹ØµØ± Ø®Ø±ÛŒØ¯ Ø±ÙØªÙ….', german: 'Ich ging nachmittags einkaufen.' },
            { persian: 'ØªÙˆ Ú†Ù‡ Ø®Ø±ÛŒØ¯ÛŒØŸ', german: 'Was hast du gekauft?' },
            { persian: 'Ø§Ùˆ Ø´Ø¨ Ø´Ø§Ù… Ø¯Ø±Ø³Øª Ú©Ø±Ø¯.', german: 'Er/Sie kochte abends Abendessen.' },
            { persian: 'Ø¢Ù†Ù‡Ø§ Ø³Ø§Ø¹Øª Ù†Ù‡ Ø´Ø§Ù… Ø®ÙˆØ±Ø¯Ù†Ø¯.', german: 'Sie aÃŸen um neun Uhr Abendessen.' },
            { persian: 'Ù…Ù† ÛŒÚ© ÙÛŒÙ„Ù… Ø¯ÛŒØ¯Ù….', german: 'Ich sah einen Film.' },
            { persian: 'ØªÙˆ Ú©ÛŒ Ø®ÙˆØ§Ø¨ÛŒØ¯ÛŒØŸ', german: 'Wann schliefst du?' },
            { persian: 'Ù…Ø§ Ø¯ÛŒØ±ÙˆØ² Ø¨Ù‡ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ù†Ø±ÙØªÛŒÙ….', german: 'Wir gingen gestern nicht zur UniversitÃ¤t.' },
            { persian: 'Ø§Ùˆ ØµØ¨Ø­Ø§Ù†Ù‡ Ù†Ø®ÙˆØ±Ø¯.', german: 'Er/Sie aÃŸ kein FrÃ¼hstÃ¼ck.' },
            { persian: 'Ù…Ù† Ø¨Ù‡ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ù†Ø±ÙØªÙ….', german: 'Ich ging nicht zur Bibliothek.' }
        ];

        let translationInitialized = false;

        function initTranslation() {
            if (translationInitialized) return;
            translationInitialized = true;
            
            const container = document.getElementById('translationQuestions');
            translationExercises.forEach((ex, i) => {
                const qDiv = document.createElement('div');
                qDiv.className = 'question';
                qDiv.innerHTML = `
                    <div class="question-text persian-question">${ex.persian}</div>
                    <input type="text" id="trans-${i}" placeholder="Deutsche Ãœbersetzung..." style="direction: ltr; text-align: left;">
                    <div class="feedback" id="trans-feedback-${i}"></div>
                `;
                container.appendChild(qDiv);
            });
        }

        function checkTranslations() {
            let score = 0;
            translationExercises.forEach((ex, i) => {
                const input = document.getElementById(`trans-${i}`);
                const feedback = document.getElementById(`trans-feedback-${i}`);
                const userAnswer = normalizeAnswer(input.value);
                const correctAnswer = normalizeAnswer(ex.german);

                const keyWords = correctAnswer.split(/\s+/).filter(w => w.length > 3);
                let matches = 0;
                keyWords.forEach(word => {
                    if (userAnswer.includes(word)) matches++;
                });

                if (matches >= keyWords.length * 0.6) {
                    feedback.textContent = 'âœ“ Gut Ã¼bersetzt!';
                    feedback.className = 'feedback correct';
                    score++;
                } else {
                    feedback.textContent = `MÃ¶gliche Ãœbersetzung: ${ex.german}`;
                    feedback.className = 'feedback incorrect';
                }
                feedback.style.display = 'block';
            });

            const scoreDiv = document.getElementById('translationScore');
            scoreDiv.textContent = `Ergebnis: ${score} / ${translationExercises.length} richtig (${Math.round(score/translationExercises.length*100)}%)`;
            scoreDiv.style.display = 'block';

            const progress = document.getElementById('translationProgress');
            progress.style.width = '100%';
            progress.textContent = `${translationExercises.length} / ${translationExercises.length}`;
        }

        // Quiz
        const quizQuestions = [
            {
                question: 'Wie heiÃŸt "ich ging" auf Persisch?',
                options: ['Ø±ÙØªÙ…', 'Ø±ÙØªÛŒ', 'Ø±ÙØª', 'Ø±ÙØªÛŒÙ…'],
                correct: 0
            },
            {
                question: 'Welche Form ist "du aÃŸest"?',
                options: ['Ø®ÙˆØ±Ø¯Ù…', 'Ø®ÙˆØ±Ø¯ÛŒ', 'Ø®ÙˆØ±Ø¯', 'Ø®ÙˆØ±Ø¯ÛŒØ¯'],
                correct: 1
            },
            {
                question: 'Was bedeutet "Ù†ÙˆØ´ÛŒØ¯ÛŒÙ…"?',
                options: ['ich trank', 'du trankst', 'wir tranken', 'sie tranken'],
                correct: 2
            },
            {
                question: 'Wie konjugiert man "Ø¯Ø§Ø´ØªÙ†" fÃ¼r "er/sie"?',
                options: ['Ø¯Ø§Ø´ØªÙ…', 'Ø¯Ø§Ø´ØªÛŒ', 'Ø¯Ø§Ø´Øª', 'Ø¯Ø§Ø´ØªÛŒÙ…'],
                correct: 2
            },
            {
                question: 'Was ist die richtige Form: "wir gingen"?',
                options: ['Ø±ÙØªÙ…', 'Ø±ÙØªÛŒ', 'Ø±ÙØªÛŒÙ…', 'Ø±ÙØªÙ†Ø¯'],
                correct: 2
            },
            {
                question: 'Wie sagt man "sie (Plural) sahen"?',
                options: ['Ø¯ÛŒØ¯Ù…', 'Ø¯ÛŒØ¯', 'Ø¯ÛŒØ¯ÛŒÙ…', 'Ø¯ÛŒØ¯Ù†Ø¯'],
                correct: 3
            },
            {
                question: 'Was bedeutet "Ø®ÙˆØ§Ù†Ø¯ÛŒ"?',
                options: ['ich las', 'du lasest', 'er/sie las', 'wir lasen'],
                correct: 1
            },
            {
                question: 'Welche Form ist "ich schlief"?',
                options: ['Ø®ÙˆØ§Ø¨ÛŒØ¯Ù…', 'Ø®ÙˆØ§Ø¨ÛŒØ¯ÛŒ', 'Ø®ÙˆØ§Ø¨ÛŒØ¯', 'Ø®ÙˆØ§Ø¨ÛŒØ¯ÛŒÙ…'],
                correct: 0
            },
            {
                question: 'Was ist "ihr hattet" auf Persisch?',
                options: ['Ø¯Ø§Ø´ØªÙ…', 'Ø¯Ø§Ø´ØªÛŒ', 'Ø¯Ø§Ø´ØªÛŒÙ…', 'Ø¯Ø§Ø´ØªÛŒØ¯'],
                correct: 3
            },
            {
                question: 'Wie heiÃŸt "er/sie kehrte zurÃ¼ck"?',
                options: ['Ø¨Ø±Ú¯Ø´ØªÙ…', 'Ø¨Ø±Ú¯Ø´ØªÛŒ', 'Ø¨Ø±Ú¯Ø´Øª', 'Ø¨Ø±Ú¯Ø´ØªÛŒÙ…'],
                correct: 2
            },
            {
                question: 'Was bedeutet "Ø®Ø±ÛŒØ¯Ù†Ø¯"?',
                options: ['ich kaufte', 'du kauftest', 'wir kauften', 'sie kauften'],
                correct: 3
            },
            {
                question: 'Welche Negation ist richtig fÃ¼r "ich ging nicht"?',
                options: ['Ø±ÙØªÙ…', 'Ù†Ø±ÙØªÙ…', 'Ù†Ø±ÙØªÛŒ', 'Ø±ÙØªÙ… Ù†Ù‡'],
                correct: 1
            },
            {
                question: 'Wie sagt man "wir aÃŸen nicht"?',
                options: ['Ù†Ø®ÙˆØ±Ø¯Ù…', 'Ù†Ø®ÙˆØ±Ø¯ÛŒ', 'Ù†Ø®ÙˆØ±Ø¯ÛŒÙ…', 'Ù†Ø®ÙˆØ±Ø¯Ù†Ø¯'],
                correct: 2
            },
            {
                question: 'Was ist die 1. Person Singular von "Ø¯ÛŒØ¯Ù†"?',
                options: ['Ø¯ÛŒØ¯Ù…', 'Ø¯ÛŒØ¯ÛŒ', 'Ø¯ÛŒØ¯', 'Ø¯ÛŒØ¯ÛŒÙ…'],
                correct: 0
            },
            {
                question: 'Wie konjugiert man "Ú©Ø±Ø¯Ù†" fÃ¼r "wir"?',
                options: ['Ú©Ø±Ø¯Ù…', 'Ú©Ø±Ø¯ÛŒ', 'Ú©Ø±Ø¯', 'Ú©Ø±Ø¯ÛŒÙ…'],
                correct: 3
            },
            {
                question: 'Was bedeutet "Ù†ÙˆØ´ÛŒØ¯ÛŒ"?',
                options: ['ich trank', 'du trankst', 'er/sie trank', 'wir tranken'],
                correct: 1
            },
            {
                question: 'Welche Form ist "sie (Pl.) hÃ¶rten"?',
                options: ['Ø´Ù†ÛŒØ¯Ù…', 'Ø´Ù†ÛŒØ¯', 'Ø´Ù†ÛŒØ¯ÛŒÙ…', 'Ø´Ù†ÛŒØ¯Ù†Ø¯'],
                correct: 3
            },
            {
                question: 'Wie sagt man "du schliefst nicht"?',
                options: ['Ù†Ø®ÙˆØ§Ø¨ÛŒØ¯Ù…', 'Ù†Ø®ÙˆØ§Ø¨ÛŒØ¯ÛŒ', 'Ù†Ø®ÙˆØ§Ø¨ÛŒØ¯', 'Ø®ÙˆØ§Ø¨ÛŒØ¯ÛŒ Ù†Ù‡'],
                correct: 1
            },
            {
                question: 'Was ist "ihr kauftet" auf Persisch?',
                options: ['Ø®Ø±ÛŒØ¯Ù…', 'Ø®Ø±ÛŒØ¯ÛŒ', 'Ø®Ø±ÛŒØ¯ÛŒÙ…', 'Ø®Ø±ÛŒØ¯ÛŒØ¯'],
                correct: 3
            },
            {
                question: 'Wie heiÃŸt "wir machten/kochten"?',
                options: ['Ú©Ø±Ø¯Ù…', 'Ú©Ø±Ø¯ÛŒ', 'Ú©Ø±Ø¯', 'Ú©Ø±Ø¯ÛŒÙ…'],
                correct: 3
            }
        ];

        let currentQuiz = 0;
        let quizScore = 0;
        let quizAnswered = false;

        function initQuiz() {
            showQuizQuestion();
        }

        function showQuizQuestion() {
            if (currentQuiz >= quizQuestions.length) {
                showQuizResults();
                return;
            }

            const q = quizQuestions[currentQuiz];
            document.getElementById('quizText').textContent = q.question;
            
            const optionsDiv = document.getElementById('quizOptions');
            optionsDiv.innerHTML = '';
            
            q.options.forEach((option, i) => {
                const label = document.createElement('label');
                label.className = 'radio-option';
                label.innerHTML = `
                    <input type="radio" name="quiz" value="${i}">
                    <span style="direction: rtl;">${option}</span>
                `;
                label.onclick = () => {
                    document.querySelectorAll('.radio-option').forEach(opt => opt.classList.remove('selected'));
                    label.classList.add('selected');
                };
                optionsDiv.appendChild(label);
            });

            document.getElementById('quizFeedback').style.display = 'none';
            document.getElementById('quizNext').style.display = 'none';
            quizAnswered = false;
            updateQuizProgress();
        }

        function checkQuiz() {
            if (quizAnswered) return;

            const selected = document.querySelector('input[name="quiz"]:checked');
            if (!selected) {
                alert('Bitte wÃ¤hle eine Antwort aus!');
                return;
            }

            quizAnswered = true;
            const q = quizQuestions[currentQuiz];
            const feedback = document.getElementById('quizFeedback');

            if (parseInt(selected.value) === q.correct) {
                feedback.textContent = 'âœ“ Richtig!';
                feedback.className = 'feedback correct';
                quizScore++;
            } else {
                feedback.textContent = `âœ— Falsch. Die richtige Antwort ist: ${q.options[q.correct]}`;
                feedback.className = 'feedback incorrect';
            }
            feedback.style.display = 'block';
            document.getElementById('quizNext').style.display = 'block';
        }

        function nextQuiz() {
            currentQuiz++;
            showQuizQuestion();
        }

        function showQuizResults() {
            document.getElementById('quizQuestion').style.display = 'none';
            document.querySelector('#page-quiz .btn-check').style.display = 'none';
            const scoreDiv = document.getElementById('quizScore');
            scoreDiv.textContent = `Ergebnis: ${quizScore} / ${quizQuestions.length} richtig (${Math.round(quizScore/quizQuestions.length*100)}%)`;
            scoreDiv.style.display = 'block';
        }

        function updateQuizProgress() {
            const progress = document.getElementById('quizProgress');
            const percent = (currentQuiz / quizQuestions.length) * 100;
            progress.style.width = percent + '%';
            progress.textContent = `${currentQuiz} / ${quizQuestions.length}`;
        }

        // Vokabel-Quiz
        let vocabQuizData = [];
        let currentVocabQuiz = 0;
        let vocabQuizScore = 0;
        let vocabQuizAnswered = false;

        function initVocabQuiz() {
            vocabQuizData = [];
            for (const [category, words] of Object.entries(vocabularyData)) {
                words.forEach(word => {
                    vocabQuizData.push({
                        question: `Was heiÃŸt "${word.german}" auf Persisch?`,
                        correct: word.persian,
                        category: category
                    });
                });
            }
            
            shuffleArray(vocabQuizData);
            vocabQuizData = vocabQuizData.slice(0, 20);
            
            vocabQuizData.forEach(q => {
                const allWords = [];
                for (const words of Object.values(vocabularyData)) {
                    words.forEach(w => allWords.push(w.persian));
                }
                
                const wrongOptions = allWords.filter(w => w !== q.correct);
                shuffleArray(wrongOptions);
                q.options = [q.correct, ...wrongOptions.slice(0, 3)];
                shuffleArray(q.options);
                q.correctIndex = q.options.indexOf(q.correct);
            });
            
            showVocabQuizQuestion();
        }

        function showVocabQuizQuestion() {
            if (currentVocabQuiz >= vocabQuizData.length) {
                showVocabQuizResults();
                return;
            }

            const q = vocabQuizData[currentVocabQuiz];
            document.getElementById('vocabQuizText').textContent = q.question;
            
            const optionsDiv = document.getElementById('vocabQuizOptions');
            optionsDiv.innerHTML = '';
            
            q.options.forEach((option, i) => {
                const label = document.createElement('label');
                label.className = 'radio-option';
                label.innerHTML = `
                    <input type="radio" name="vocabquiz" value="${i}">
                    <span style="direction: rtl;">${option}</span>
                `;
                label.onclick = () => {
                    document.querySelectorAll('#vocabQuizOptions .radio-option').forEach(opt => opt.classList.remove('selected'));
                    label.classList.add('selected');
                };
                optionsDiv.appendChild(label);
            });

            document.getElementById('vocabQuizFeedback').style.display = 'none';
            document.getElementById('vocabQuizNext').style.display = 'none';
            vocabQuizAnswered = false;
            updateVocabQuizProgress();
        }

        function checkVocabQuiz() {
            if (vocabQuizAnswered) return;

            const selected = document.querySelector('input[name="vocabquiz"]:checked');
            if (!selected) {
                alert('Bitte wÃ¤hle eine Antwort aus!');
                return;
            }

            vocabQuizAnswered = true;
            const q = vocabQuizData[currentVocabQuiz];
            const feedback = document.getElementById('vocabQuizFeedback');

            if (parseInt(selected.value) === q.correctIndex) {
                feedback.textContent = 'âœ“ Richtig!';
                feedback.className = 'feedback correct';
                vocabQuizScore++;
            } else {
                feedback.textContent = `âœ— Falsch. Die richtige Antwort ist: ${q.correct}`;
                feedback.className = 'feedback incorrect';
            }
            feedback.style.display = 'block';
            document.getElementById('vocabQuizNext').style.display = 'block';
        }

        function nextVocabQuiz() {
            currentVocabQuiz++;
            showVocabQuizQuestion();
        }

        function showVocabQuizResults() {
            document.querySelector('#page-vocabquiz .question').style.display = 'none';
            document.querySelector('#page-vocabquiz .btn-check').style.display = 'none';
            const scoreDiv = document.getElementById('vocabQuizScore');
            scoreDiv.textContent = `Ergebnis: ${vocabQuizScore} / ${vocabQuizData.length} richtig (${Math.round(vocabQuizScore/vocabQuizData.length*100)}%)`;
            scoreDiv.style.display = 'block';
        }

        function updateVocabQuizProgress() {
            const progress = document.getElementById('vocabQuizProgress');
            const percent = (currentVocabQuiz / vocabQuizData.length) * 100;
            progress.style.width = percent + '%';
            progress.textContent = `${currentVocabQuiz} / ${vocabQuizData.length}`;
        }

        // Hilfsfunktionen
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
    </script>
</body>
</html>